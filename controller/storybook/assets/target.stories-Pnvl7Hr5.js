import{i as v,r as ne,g as oe,a as Z,c as q,d as re,v as ee,f as _,b as A,e as se,h as ae}from"./fullscreen-F9Lc8mVH.js";import{g as ce,a as le,r as I,c as de,b as ue,d as pe}from"./preview-zRw4MxdE.js";const he=e=>{let t=[],n=[];const r=(i,a)=>{const u=setTimeout(i,a);return n.push(u),u},m=()=>{n.forEach(i=>{clearTimeout(i)}),n=[]},o=(i,a,u,w=void 0)=>{i.addEventListener(a,u,w),t.push([i,a,u,w])},h=()=>{t.forEach(i=>{const[a,u,w,g]=i;a.removeEventListener(u,w,g)}),t=[]},l=i=>{const a=i.toElement||i.relatedTarget||i.target,u=e.element.currentTargetElement;if(a!==u&&!e.element.contains(a)){const w=r(e.hide,300),g=()=>{clearTimeout(w)};o(e.element,"mouseenter",g)}},y=i=>{const a=e.element.querySelector(".wikipediapreview-body"),u=e.element.querySelector(".wikipediapreview-header"),w=e.element.querySelector(".wikipediapreview-footer-cta")||e.element.querySelector(".wikipediapreview-footer-loading");if(a)if(e.element.style[2]==="bottom"||e.element.style.bottom){const g=e.element.getBoundingClientRect().top,E=parseInt(window.getComputedStyle(a).maxHeight.slice(0,-2));a.style.maxHeight=Math.min(i,E+g)+"px"}else{const g=e.element.getBoundingClientRect().top,E=window.getComputedStyle(u).height.slice(0,-2),k=w?window.getComputedStyle(w).height.slice(0,-2):0,$=window.innerHeight-g-E-k;a.style.maxHeight=Math.min(i,$)+"px"}},f=()=>{const{lang:a,title:u}=e;e.element.component.wikipediapreview.classList.add("expanded"),v||y(496),!e.loading&&a&&u&&ne(a,u,w=>{const g=e.element.component.wikipediapreviewGallery;w&&w.length>0?g.appendChild(ce(w,e)):e.element.component.body.removeChild(g)})},L=i=>{let a,u,w,g;const E=i.querySelector(".wikipediapreview-header"),k=i.querySelector(".wikipediapreview-body"),$=b=>{a=b.touches[0].clientY,w=window.getComputedStyle(k),g=Number(w.height.slice(0,-2))},Y=(b,x)=>{x&&b.preventDefault();const H=b.touches[0].clientY,N=a-H,O=g+N,ie=!i.querySelector(".wikipediapreview.expanded")&&!x||x;k.style.transition="auto",u=H,ie&&(k.style.maxHeight=O+"px")},U=b=>{const x=i.querySelector(".wikipediapreview.expanded"),H=a-u,N=Math.abs(H)>80,O=!x&&!b||b;k.style.transition="all 0.25s ease-in-out",H<0&&N&&O?e.hide():H>0&&N&&O&&!x?(k.style.maxHeight="70vh",f()):k.style.maxHeight=g+"px"};o(k,"touchstart",$),o(k,"touchmove",b=>{Y(b,!1)}),o(k,"touchend",()=>U(!1)),o(E,"touchstart",$),o(E,"touchmove",b=>{Y(b,!0)}),o(E,"touchend",()=>U(!0))};return{onHide:()=>{e.element.component.wikipediapreview.classList.remove("expanded"),e.lang=null,e.title=null,e.loading=!1;const i=e.element.querySelector(".wikipediapreview-body");i.style.transition="auto",h(),m()},onShow:i=>{if(i.component={body:i.querySelector(".wikipediapreview-body"),wikipediapreview:i.querySelector(".wikipediapreview"),wikipediapreviewGallery:i.querySelector(".wikipediapreview-gallery"),closeBtn:i.querySelector(".wikipediapreview-header-closebtn"),readMore:i.querySelector(".wikipediapreview-footer-cta-readmore"),content:i.querySelector(".wikipediapreview-body > p")},i.component.content&&i.component.content.getBoundingClientRect().height<248?f():v||y(248),o(i.component.closeBtn,"click",e.hide),i.component.readMore&&o(i.component.readMore,"click",f),v){const a=document.querySelector(".wp-dark-screen");o(a,"click",e.hide,!0),L(i)}else o(i,"mouseleave",l),o(i.currentTargetElement,"mouseleave",l)},onExpand:f}};let p;const we=(e,t,n,r,m)=>{const o=e.left+e.width/2,h=e.top+e.height/2,l=o<=r/2,y=h<=m/2,f=l?e.left:e.left+e.width-t,L=y?e.top+e.height:"",C=y?"":m-e.top;return{left:f,top:L,bottom:C}},B=e=>e&&e+"px",me=e=>({left:e.left-3,right:e.right+3,top:e.top-3,bottom:e.bottom+3}),fe=(e,{x:t,y:n})=>{const r=e.getClientRects();for(let m=0;m<r.length;m++){const o=me(r[m]);if(t>=o.left&&t<=o.right&&n>=o.top&&n<=o.bottom)return r[m]}return r[0]||e.getBoundingClientRect()},ge=(e,t=window)=>{p||(p=t.document.createElement("div"),p.classList.add("wp-popup"),p.style.visibility="hidden",e.appendChild(p));const n={};return{show:(h,l,y)=>{p.innerHTML=h;const f=we(fe(l,y),p.offsetWidth,p.offsetHeight,t.innerWidth,t.innerHeight);p.style.left=B(f.left),p.style.top=B(f.top),p.style.bottom=B(f.bottom),p.currentTargetElement=l,p.style.visibility="visible",n.onShow&&n.onShow(p)},hide:()=>{n.onHide&&n.onHide(p),p.style.visibility="hidden",p.currentTargetElement=null},subscribe:(h={})=>{h.onShow&&(n.onShow=h.onShow),h.onHide&&(n.onHide=h.onHide)},element:p}};let S,te;const ve=e=>{if(!e.querySelector(".wp-dark-screen")){const t=e.createElement("div");t.classList.add("wp-dark-screen"),e.body.appendChild(t),te=e.body.style.overflow,e.body.style.overflow="hidden"}},ye=e=>{const t=e.getElementsByClassName("wp-dark-screen");e.body.removeChild(t[0]),e.body.style.overflow=te},ke=(e,t=window)=>{S||(S=t.document.createElement("div"),S.classList.add("wp-touch-popup"),S.style.visibility="hidden",e.appendChild(S));const n={};return{show:l=>{S.innerHTML=l,S.style.visibility="visible",ve(t.document),n.onShow&&n.onShow(S)},hide:()=>{n.onHide&&n.onHide(S),S.style.visibility="hidden",ye(t.document)},expand:()=>{n.onExpand&&n.onExpand()},subscribe:(l={})=>{l.onShow&&(n.onShow=l.onShow),l.onHide&&(n.onHide=l.onHide),l.onExpand&&(n.onExpand=l.onExpand)},element:S}},T={UNKNOWN:"unknown",READY:"ready",LOADING:"loading",SHOWN_OK:"shown_ok",SHOWN_ERROR:"shown_error"},c={colorScheme:null,events:{},lang:null,title:null,target:null,pointer:{x:0,y:0},status:T.UNKNOWN,requestId:null};let d;const D={init:(e,t,n)=>{d=v?ke(e):ge(e),d.subscribe(he(d)),c.colorScheme=t,c.events=n,c.status=T.READY},trigger:(e,t,n,r)=>{if(c.status===T.UNKNOWN||c.target===r&&c.status!==T.SHOWN_ERROR)return;d.element.style.visibility==="visible"&&d.hide();const m=c.requestId=Date.now();c.title=e,c.lang=t,c.target=r,c.status=T.LOADING,d.dir=oe(t),d.show(le(v,t,d.dir,status.colorScheme),r,n),Z(t,e,o=>{if(m===c.requestId&&c.status===T.LOADING){if(d.loading=!1,o){if(d.lang=t,d.title=e,o.type==="standard")d.show(I(t,o,v,c.colorScheme),r,n),q(c.events,"onShow",[e,t,"standard"]);else if(o.type==="disambiguation"){const l=o.extractHtml?I(t,o,v,c.colorScheme):de(v,t,o.title,o.dir,c.colorScheme);d.show(l,r,n),q(c.events,"onShow",[e,t,"disambiguation"])}}else re()?(d.show(ue(v,t,e,d.dir,c.colorScheme),r,n),q(c.events,"onShow",[e,t,"error"])):(d.show(pe(v,t,d.dir,c.colorScheme),r,n),q(c.events,"onShow",[e,t,"offline"]),d.element.querySelector(".wikipediapreview-body-action").addEventListener("click",()=>{D.trigger(e,t,n,r)}));const h=d.element.querySelector(".wikipediapreview-footer-cta-readonwiki, .wikipediapreview-cta-readonwiki");h&&h.addEventListener("click",()=>{q(c.events,"onWikiRead",[e,t])})}})},close:()=>{d&&d.hide()}},be=(e,t,n)=>{Z(t,e,r=>{n(I(t,r,v))})};function Se({root:e=document,selector:t="[data-wikipedia-preview]",lang:n="en",detectLinks:r=!1,popupContainer:m=document.body,events:o={},debug:h=!1,prefersColorScheme:l="detect"}){const y=[],f=[];D.init(m,l,o);const L=s=>{s.preventDefault();const i=s.currentTarget;D.trigger(i.getAttribute("data-wp-title")||i.textContent,i.getAttribute("data-wp-lang")||n,{x:s.clientX,y:s.clientY},i)};_(e,t,s=>{y.push({node:s,text:s.textContent,title:s.getAttribute("data-wp-title")||s.textContent,lang:s.getAttribute("data-wp-lang")||n})}),r&&_(e,"a",s=>{const i=se(s.getAttribute("href"));if(i){s.setAttribute("data-wp-title",i.title),s.setAttribute("data-wp-lang",i.lang),f.push({node:s,text:s.textContent,title:i.title,lang:i.lang});const a=ae().split("="),u=new URL(s.href);u.searchParams.set(a[0],a[1]),s.href=u.href}});const C=v?"click":"mouseenter";y.concat(f).forEach(s=>{s.node.addEventListener(C,L)}),h&&(console.group("Wikipedia Preview [debug mode]"),console.group(`Searching for "${t}" inside ${e}, Total links found: ${y.length}`),y.forEach((s,i)=>{console.log(i+1,`${s.text} -> ${A(s.lang,s.title,v,!1)}`)}),console.groupEnd(),r&&(console.group(`Searching for links to Wikipedia, Total links found: ${f.length}`),f.forEach((s,i)=>{console.log(i+1,`${s.text} -> ${A(s.lang,s.title,v,!1)}`)}),console.groupEnd()),console.groupEnd())}ee();const R={init:Se,version:ee,getPreviewHtml:be},Te={title:"Targets",argTypes:{lang:{name:"Language",control:"select",options:["en","fr","hi","ks","he","sv"]},title:{name:"Article Title",control:"text"}},args:{lang:"en",title:"Cat"}},P=({lang:e,title:t})=>{const n=document.createElement("div"),r=`<a href="${A(e,t,!0,!1)}">${t} (${e})</a>`;return n.innerHTML=r,R.init({root:n,detectLinks:!0}),n},M=({lang:e,title:t})=>{const n=document.createElement("div"),r=`<a href="${A(e,t,!0,!1)}"><img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Wikipedia-logo-v2.png"></a>`;return n.innerHTML=r,R.init({root:n,detectLinks:!0}),n},W=({lang:e,title:t})=>{const n=document.createElement("div"),r=`<span class="wmf-wp-with-preview" data-wikipedia-preview data-wp-title="${t}">${t} (${e})</span>`;return n.innerHTML=r,R.init({root:n,lang:e}),n};var G,K,X;P.parameters={...P.parameters,docs:{...(G=P.parameters)==null?void 0:G.docs,source:{originalSource:`({
  lang,
  title
}) => {
  const container = document.createElement('div');
  const template = \`<a href="\${buildWikipediaUrl(lang, title, true, false)}">\${title} (\${lang})</a>\`;
  container.innerHTML = template;
  wikipediaPreview.init({
    root: container,
    detectLinks: true
  });
  return container;
}`,...(X=(K=P.parameters)==null?void 0:K.docs)==null?void 0:X.source}}};var F,Q,j;M.parameters={...M.parameters,docs:{...(F=M.parameters)==null?void 0:F.docs,source:{originalSource:`({
  lang,
  title
}) => {
  const container = document.createElement('div');
  const template = \`<a href="\${buildWikipediaUrl(lang, title, true, false)}"><img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Wikipedia-logo-v2.png"></a>\`;
  container.innerHTML = template;
  wikipediaPreview.init({
    root: container,
    detectLinks: true
  });
  return container;
}`,...(j=(Q=M.parameters)==null?void 0:Q.docs)==null?void 0:j.source}}};var z,J,V;W.parameters={...W.parameters,docs:{...(z=W.parameters)==null?void 0:z.docs,source:{originalSource:`({
  lang,
  title
}) => {
  const container = document.createElement('div');
  const template = \`<span class="wmf-wp-with-preview" data-wikipedia-preview data-wp-title="\${title}">\${title} (\${lang})</span>\`;
  container.innerHTML = template;
  wikipediaPreview.init({
    root: container,
    lang
  });
  return container;
}`,...(V=(J=W.parameters)==null?void 0:J.docs)==null?void 0:V.source}}};const Le=["Hyperlink","Image","Text"];export{P as Hyperlink,M as Image,W as Text,Le as __namedExportsOrder,Te as default};
