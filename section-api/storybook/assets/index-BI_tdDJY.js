import{i as m,r as R,v as D,g as G,a as U,b as $,c as F,d as X,e as Q,f as j}from"./fullscreen-c4FLRwU4.js";import{g as z,r as W,a as J,c as K,b as V,d as Z}from"./preview-DgBkcZY4.js";const _=e=>{let r=[],o=[];const a=(t,s)=>{const n=setTimeout(t,s);return o.push(n),n},y=()=>{o.forEach(t=>{clearTimeout(t)}),o=[]},c=(t,s,n,i=void 0)=>{t.addEventListener(s,n,i),r.push([t,s,n,i])},v=()=>{r.forEach(t=>{const[s,n,i,d]=t;s.removeEventListener(n,i,d)}),r=[]},f=t=>{const s=t.toElement||t.relatedTarget||t.target,n=e.element.currentTargetElement;if(s!==n&&!e.element.contains(s)){const i=a(e.hide,300),d=()=>{clearTimeout(i)};c(e.element,"mouseenter",d)}},S=t=>{const s=e.element.querySelector(".wikipediapreview-body"),n=e.element.querySelector(".wikipediapreview-header"),i=e.element.querySelector(".wikipediapreview-footer-cta")||e.element.querySelector(".wikipediapreview-footer-loading");if(s)if(e.element.style[2]==="bottom"||e.element.style.bottom){const d=e.element.getBoundingClientRect().top,h=parseInt(window.getComputedStyle(s).maxHeight.slice(0,-2));s.style.maxHeight=Math.min(t,h+d)+"px"}else{const d=e.element.getBoundingClientRect().top,h=window.getComputedStyle(n).height.slice(0,-2),p=i?window.getComputedStyle(i).height.slice(0,-2):0,u=window.innerHeight-d-h-p;s.style.maxHeight=Math.min(t,u)+"px"}},l=()=>{const{lang:s,title:n}=e;e.element.component.wikipediapreview.classList.add("expanded"),m||S(496),!e.loading&&s&&n&&R(s,n,i=>{const d=e.element.component.wikipediapreviewGallery;i&&i.length>0?d.appendChild(z(i,e)):e.element.component.body.removeChild(d)})},P=t=>{let s,n,i,d;const h=t.querySelector(".wikipediapreview-header"),p=t.querySelector(".wikipediapreview-body"),u=w=>{s=w.touches[0].clientY,i=window.getComputedStyle(p),d=Number(i.height.slice(0,-2))},x=(w,H)=>{H&&w.preventDefault();const b=w.touches[0].clientY,L=s-b,B=d+L,O=!t.querySelector(".wikipediapreview.expanded")&&!H||H;p.style.transition="auto",n=b,O&&(p.style.maxHeight=B+"px")},T=w=>{const H=t.querySelector(".wikipediapreview.expanded"),b=s-n,L=Math.abs(b)>80,B=!H&&!w||w;p.style.transition="all 0.25s ease-in-out",b<0&&L&&B?e.hide():b>0&&L&&B&&!H?(p.style.maxHeight="70vh",l()):p.style.maxHeight=d+"px"};c(p,"touchstart",u),c(p,"touchmove",w=>{x(w,!1)}),c(p,"touchend",()=>T(!1)),c(h,"touchstart",u),c(h,"touchmove",w=>{x(w,!0)}),c(h,"touchend",()=>T(!0))};return{onHide:()=>{e.element.component.wikipediapreview.classList.remove("expanded"),e.lang=null,e.title=null,e.loading=!1;const t=e.element.querySelector(".wikipediapreview-body");t.style.transition="auto",v(),y()},onShow:t=>{if(t.component={body:t.querySelector(".wikipediapreview-body"),wikipediapreview:t.querySelector(".wikipediapreview"),wikipediapreviewGallery:t.querySelector(".wikipediapreview-gallery"),closeBtn:t.querySelector(".wikipediapreview-header-closebtn"),readMore:t.querySelector(".wikipediapreview-footer-cta-readmore"),content:t.querySelector(".wikipediapreview-body > p")},t.component.content&&t.component.content.getBoundingClientRect().height<248?l():m||S(248),m&&c(t.component.closeBtn,"click",e.hide),t.component.readMore&&c(t.component.readMore,"click",l),m){const s=document.querySelector(".wp-dark-screen");c(s,"click",e.hide,!0),P(t)}else c(t,"mouseleave",f),c(t.currentTargetElement,"mouseleave",f)},onExpand:l}};let g;const ee=(e,r,o,a,y)=>{const c=e.left+e.width/2,v=e.top+e.height/2,f=c<=a/2,S=v<=y/2,l=f?e.left:e.left+e.width-r,P=S?e.top+e.height:"",E=S?"":y-e.top;return{left:l,top:P,bottom:E}},M=e=>e&&e+"px",te=e=>({left:e.left-3,right:e.right+3,top:e.top-3,bottom:e.bottom+3}),ie=(e,{x:r,y:o})=>{const a=e.getClientRects();for(let y=0;y<a.length;y++){const c=te(a[y]);if(r>=c.left&&r<=c.right&&o>=c.top&&o<=c.bottom)return a[y]}return a[0]||e.getBoundingClientRect()},oe=(e,r=window)=>{g||(g=r.document.createElement("div"),g.classList.add("wp-popup"),g.style.visibility="hidden",e.appendChild(g));const o={};return{show:(v,f,S)=>{g.innerHTML=v;const l=ee(ie(f,S),g.offsetWidth,g.offsetHeight,r.innerWidth,r.innerHeight);g.style.left=M(l.left),g.style.top=M(l.top),g.style.bottom=M(l.bottom),g.currentTargetElement=f,g.style.visibility="visible",o.onShow&&o.onShow(g)},hide:()=>{o.onHide&&o.onHide(g),g.style.visibility="hidden",g.currentTargetElement=null},subscribe:(v={})=>{v.onShow&&(o.onShow=v.onShow),v.onHide&&(o.onHide=v.onHide)},element:g}};let k,N;const ne=e=>{if(!e.querySelector(".wp-dark-screen")){const r=e.createElement("div");r.classList.add("wp-dark-screen"),e.body.appendChild(r),N=e.body.style.overflow,e.body.style.overflow="hidden"}},re=e=>{const r=e.getElementsByClassName("wp-dark-screen");e.body.removeChild(r[0]),e.body.style.overflow=N},se=(e,r=window)=>{k||(k=r.document.createElement("div"),k.classList.add("wp-touch-popup"),k.style.visibility="hidden",e.appendChild(k));const o={};return{show:f=>{k.innerHTML=f,k.style.visibility="visible",ne(r.document),o.onShow&&o.onShow(k)},hide:()=>{o.onHide&&o.onHide(k),k.style.visibility="hidden",re(r.document)},expand:()=>{o.onExpand&&o.onExpand()},subscribe:(f={})=>{f.onShow&&(o.onShow=f.onShow),f.onHide&&(o.onHide=f.onHide),f.onExpand&&(o.onExpand=f.onExpand)},element:k}},A=(e,r,o)=>{const a=e&&e[r];if(a instanceof Function)try{a.apply(null,o)}catch(y){console.log("Error invoking Wikipedia Preview custom callback",y)}},le=(e,r,o)=>{U(r,e,a=>{o(W(r,a,m))})},I=(e,r)=>{const o=[];(typeof e=="string"||e instanceof String)&&Array.prototype.forEach.call(document.querySelectorAll(e),a=>{o.push(a)}),(e instanceof Document||e instanceof Element)&&o.push(e),Array.isArray(e)&&e.forEach(a=>{a instanceof Element&&o.push(a)}),o.forEach(a=>r(a))};let Y,q;function ce({root:e=document,selector:r="[data-wikipedia-preview]",lang:o="en",detectLinks:a=!1,popupContainer:y=document.body,events:c={},debug:v=!1,prefersColorScheme:f="detect"}){const S=o,l=m?se(y):oe(y),P=_(l),E={},C=[],t=[];q=f;const s=(n,i=!1)=>{n.preventDefault();const d=Date.now(),{currentTarget:h}=i?E:n,p=i?E.title:decodeURIComponent(h.getAttribute("data-wp-title")||h.textContent),u=i?E.lang:h.getAttribute("data-wp-lang")||S,x=i?E.pointerPosition:{x:n.clientX,y:n.clientY},T=j(u);l.element.currentTargetElement===h&&!i||(Y=d,l.element.style.visibility==="visible"&&l.hide(),l.loading=!0,l.dir=T,l.show(J(m,u,T,q),h,x),U(u,p,w=>{if(d===Y&&l.loading){if(l.loading=!1,w){if(l.lang=u,l.title=p,w.type==="standard")l.show(W(u,w,m,q),h,x),A(c,"onShow",[p,u,"standard"]);else if(w.type==="disambiguation"){const b=w.extractHtml?W(u,w,m,q):K(m,u,w.title,w.dir,q);l.show(b,h,x),A(c,"onShow",[p,u,"disambiguation"])}}else if(X())l.show(V(m,u,p,T,q),h,x),A(c,"onShow",[p,u,"error"]);else{l.show(Z(m,u,T,q),h,x),A(c,"onShow",[p,u,"offline"]);const b=document.querySelector(".wikipediapreview-body-action");E.lang=u,E.title=p,E.pointerPosition=x,E.target=h,b.addEventListener("click",L=>{s(L,!0)})}const H=l.element.querySelector(".wikipediapreview-footer-cta-readonwiki, .wikipediapreview-cta-readonwiki");if(H&&H.addEventListener("click",()=>{A(c,"onWikiRead",[p,u])}),h.tagName==="A"){const b=Q().split("="),L=new URL(h.href);L.searchParams.set(b[0],b[1]),h.href=L.href}}}))};l.subscribe(P),I(e,n=>{Array.prototype.forEach.call(n.querySelectorAll(r),i=>{m?i.addEventListener("click",s):i.addEventListener("mouseenter",s),C.push({text:i.textContent,title:i.getAttribute("data-wp-title")||i.textContent,lang:i.getAttribute("data-wp-lang")||S})})}),a&&I(e,n=>{Array.prototype.forEach.call(n.querySelectorAll("a"),i=>{const d=F(i.getAttribute("href"));d&&(i.setAttribute("data-wp-title",d.title),i.setAttribute("data-wp-lang",d.lang),m?i.addEventListener("click",s):i.addEventListener("mouseenter",s),t.push({text:i.textContent,title:d.title,lang:d.lang}))})}),v&&(console.group("Wikipedia Preview [debug mode]"),console.group(`Searching for "${r}" inside ${e}, Total links found: ${C.length}`),C.forEach((n,i)=>{console.log(i+1,`${n.text} -> ${decodeURI($(n.lang,n.title,m,!1))}`)}),console.groupEnd(),a&&(console.group(`Searching for links to Wikipedia, Total links found: ${t.length}`),t.forEach((n,i)=>{console.log(i+1,`${n.text} -> ${decodeURI($(n.lang,n.title,m,!1))}`)}),console.groupEnd()),console.groupEnd())}D();const pe={init:ce,version:D,getPreviewHtml:le,getSections:G};export{pe as w};
