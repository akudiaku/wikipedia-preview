import{i as f,r as ee,v as z,a as J,b as W,g as te,c as ie,d as ne,e as oe}from"./fullscreen-Ek9joDrm.js";import{g as re,r as K,a as ae,c as se,b as le,d as ce}from"./preview-pl4OBxdj.js";const de=e=>{let o=[],t=[];const a=(i,r)=>{const n=setTimeout(i,r);return t.push(n),n},m=()=>{t.forEach(i=>{clearTimeout(i)}),t=[]},l=(i,r,n,p=void 0)=>{i.addEventListener(r,n,p),o.push([i,r,n,p])},y=()=>{o.forEach(i=>{const[r,n,p,s]=i;r.removeEventListener(n,p,s)}),o=[]},u=i=>{const r=i.toElement||i.relatedTarget||i.target,n=e.element.currentTargetElement;if(r!==n&&!e.element.contains(r)){const p=a(e.hide,300),s=()=>{clearTimeout(p)};l(e.element,"mouseenter",s)}},d=i=>{const r=e.element.querySelector(".wikipediapreview-body"),n=e.element.querySelector(".wikipediapreview-header"),p=e.element.querySelector(".wikipediapreview-footer-cta")||e.element.querySelector(".wikipediapreview-footer-loading");if(r)if(e.element.style[2]==="bottom"||e.element.style.bottom){const s=e.element.getBoundingClientRect().top,w=parseInt(window.getComputedStyle(r).maxHeight.slice(0,-2));r.style.maxHeight=Math.min(i,w+s)+"px"}else{const s=e.element.getBoundingClientRect().top,w=window.getComputedStyle(n).height.slice(0,-2),c=p?window.getComputedStyle(p).height.slice(0,-2):0,b=window.innerHeight-s-w-c;r.style.maxHeight=Math.min(i,b)+"px"}},v=()=>{const{lang:r,title:n}=e;e.element.component.wikipediapreview.classList.add("expanded"),f||d(496),!e.loading&&r&&n&&ee(r,n,p=>{const s=e.element.component.wikipediapreviewGallery;p&&p.length>0?s.appendChild(re(p,e)):e.element.component.body.removeChild(s)})},k=i=>{let r,n,p,s;const w=i.querySelector(".wikipediapreview-header"),c=i.querySelector(".wikipediapreview-body"),b=g=>{r=g.touches[0].clientY,p=window.getComputedStyle(c),s=Number(p.height.slice(0,-2))},L=(g,E)=>{E&&g.preventDefault();const S=g.touches[0].clientY,$=r-S,A=s+$,Z=!i.querySelector(".wikipediapreview.expanded")&&!E||E;c.style.transition="auto",n=S,Z&&(c.style.maxHeight=A+"px")},H=g=>{const E=i.querySelector(".wikipediapreview.expanded"),S=r-n,$=Math.abs(S)>80,A=!E&&!g||g;c.style.transition="all 0.25s ease-in-out",S<0&&$&&A?e.hide():S>0&&$&&A&&!E?(c.style.maxHeight="70vh",v()):c.style.maxHeight=s+"px"};l(c,"touchstart",b),l(c,"touchmove",g=>{L(g,!1)}),l(c,"touchend",()=>H(!1)),l(w,"touchstart",b),l(w,"touchmove",g=>{L(g,!0)}),l(w,"touchend",()=>H(!0))};return{onHide:()=>{e.element.component.wikipediapreview.classList.remove("expanded"),e.lang=null,e.title=null,e.loading=!1;const i=e.element.querySelector(".wikipediapreview-body");i.style.transition="auto",y(),m()},onShow:i=>{if(i.component={body:i.querySelector(".wikipediapreview-body"),wikipediapreview:i.querySelector(".wikipediapreview"),wikipediapreviewGallery:i.querySelector(".wikipediapreview-gallery"),closeBtn:i.querySelector(".wikipediapreview-header-closebtn"),readMore:i.querySelector(".wikipediapreview-footer-cta-readmore"),content:i.querySelector(".wikipediapreview-body > p")},i.component.content&&i.component.content.getBoundingClientRect().height<248?v():f||d(248),l(i.component.closeBtn,"click",e.hide),i.component.readMore&&l(i.component.readMore,"click",v),f){const r=document.querySelector(".wp-dark-screen");l(r,"click",e.hide,!0),k(i)}else l(i,"mouseleave",u),l(i.currentTargetElement,"mouseleave",u)},onExpand:v}};let h;const pe=(e,o,t,a,m)=>{const l=e.left+e.width/2,y=e.top+e.height/2,u=l<=a/2,d=y<=m/2,v=u?e.left:e.left+e.width-o,k=d?e.top+e.height:"",T=d?"":m-e.top;return{left:v,top:k,bottom:T}},I=e=>e&&e+"px",ue=e=>({left:e.left-3,right:e.right+3,top:e.top-3,bottom:e.bottom+3}),he=(e,{x:o,y:t})=>{const a=e.getClientRects();for(let m=0;m<a.length;m++){const l=ue(a[m]);if(o>=l.left&&o<=l.right&&t>=l.top&&t<=l.bottom)return a[m]}return a[0]||e.getBoundingClientRect()},we=(e,o=window)=>{h||(h=o.document.createElement("div"),h.classList.add("wp-popup"),h.style.visibility="hidden",e.appendChild(h));const t={};return{show:(y,u,d)=>{h.innerHTML=y;const v=pe(he(u,d),h.offsetWidth,h.offsetHeight,o.innerWidth,o.innerHeight);h.style.left=I(v.left),h.style.top=I(v.top),h.style.bottom=I(v.bottom),h.currentTargetElement=u,h.style.visibility="visible",t.onShow&&t.onShow(h)},hide:()=>{t.onHide&&t.onHide(h),h.style.visibility="hidden",h.currentTargetElement=null},subscribe:(y={})=>{y.onShow&&(t.onShow=y.onShow),y.onHide&&(t.onHide=y.onHide)},element:h}};let x,V;const me=e=>{if(!e.querySelector(".wp-dark-screen")){const o=e.createElement("div");o.classList.add("wp-dark-screen"),e.body.appendChild(o),V=e.body.style.overflow,e.body.style.overflow="hidden"}},ge=e=>{const o=e.getElementsByClassName("wp-dark-screen");e.body.removeChild(o[0]),e.body.style.overflow=V},fe=(e,o=window)=>{x||(x=o.document.createElement("div"),x.classList.add("wp-touch-popup"),x.style.visibility="hidden",e.appendChild(x));const t={};return{show:u=>{x.innerHTML=u,x.style.visibility="visible",me(o.document),t.onShow&&t.onShow(x)},hide:()=>{t.onHide&&t.onHide(x),x.style.visibility="hidden",ge(o.document)},expand:()=>{t.onExpand&&t.onExpand()},subscribe:(u={})=>{u.onShow&&(t.onShow=u.onShow),u.onHide&&(t.onHide=u.onHide),u.onExpand&&(t.onExpand=u.onExpand)},element:x}},P=(e,o,t)=>{const a=e&&e[o];if(a instanceof Function)try{a.apply(null,t)}catch(m){console.log("Error invoking Wikipedia Preview custom callback",m)}},ye=(e,o,t)=>{J(o,e,a=>{t(K(o,a,f))})},D=(e,o)=>{const t=[];(typeof e=="string"||e instanceof String)&&Array.prototype.forEach.call(document.querySelectorAll(e),a=>{t.push(a)}),(e instanceof Document||e instanceof Element)&&t.push(e),Array.isArray(e)&&e.forEach(a=>{a instanceof Element&&t.push(a)}),t.forEach(a=>o(a))};let O;function ve({root:e=document,selector:o="[data-wikipedia-preview]",lang:t="en",detectLinks:a=!1,popupContainer:m=document.body,events:l={},debug:y=!1}){const u=t,d=f?fe(m):we(m),v=de(d),k={},T=[],q=[],i=(r,n=!1)=>{r.preventDefault();const p=Date.now(),{currentTarget:s}=n?k:r,w=n?k.title:decodeURIComponent(s.getAttribute("data-wp-title")||s.textContent),c=n?k.lang:s.getAttribute("data-wp-lang")||u,b=n?k.pointerPosition:{x:r.clientX,y:r.clientY},L=oe(c);d.element.currentTargetElement===s&&!n||(O=p,d.element.style.visibility==="visible"&&d.hide(),d.loading=!0,d.dir=L,d.show(ae(f,c,L),s,b),J(c,w,H=>{if(p===O&&d.loading){if(d.loading=!1,H)d.lang=c,d.title=w,H.type==="standard"?(d.show(K(c,H,f),s,b),P(l,"onShow",[w,c,"standard"])):H.type==="disambiguation"&&(d.show(se(f,c,H.title,H.dir),s,b),P(l,"onShow",[w,c,"disambiguation"]));else if(ie())d.show(le(f,c,w,L),s,b),P(l,"onShow",[w,c,"error"]);else{d.show(ce(f,c,L),s,b),P(l,"onShow",[w,c,"offline"]);const E=document.querySelector(".wikipediapreview-body-action");k.lang=c,k.title=w,k.pointerPosition=b,k.target=s,E.addEventListener("click",S=>{i(S,!0)})}const g=d.element.querySelector(".wikipediapreview-footer-cta-readonwiki, .wikipediapreview-cta-readonwiki");if(g&&g.addEventListener("click",()=>{P(l,"onWikiRead",[w,c])}),s.tagName==="A"){const E=ne().split("="),S=new URL(s.href);S.searchParams.set(E[0],E[1]),s.href=S.href}}}))};d.subscribe(v),D(e,r=>{Array.prototype.forEach.call(r.querySelectorAll(o),n=>{f?n.addEventListener("click",i):n.addEventListener("mouseenter",i),T.push({text:n.textContent,title:n.getAttribute("data-wp-title")||n.textContent,lang:n.getAttribute("data-wp-lang")||u})})}),a&&D(e,r=>{Array.prototype.forEach.call(r.querySelectorAll("a"),n=>{const p=te(n.getAttribute("href"));p&&(n.setAttribute("data-wp-title",p.title),n.setAttribute("data-wp-lang",p.lang),f?n.addEventListener("click",i):n.addEventListener("mouseenter",i),q.push({text:n.textContent,title:p.title,lang:p.lang}))})}),y&&(console.group("Wikipedia Preview [debug mode]"),console.group(`Searching for "${o}" inside ${e}, Total links found: ${T.length}`),T.forEach((r,n)=>{console.log(n+1,`${r.text} -> ${W(r.lang,r.title,f,!1)}`)}),console.groupEnd(),a&&(console.group(`Searching for links to Wikipedia, Total links found: ${q.length}`),q.forEach((r,n)=>{console.log(n+1,`${r.text} -> ${W(r.lang,r.title,f,!1)}`)}),console.groupEnd()),console.groupEnd())}z();const Y={init:ve,version:z,getPreviewHtml:ye},Se={title:"Targets",argTypes:{lang:{name:"Language",control:"select",options:["en","fr","hi","ks","he","sv"]},title:{name:"Article Title",control:"text"}},args:{lang:"en",title:"Cat"}},C=({lang:e,title:o})=>{const t=document.createElement("div"),a=`<a href="${W(e,o,!0,!1)}">${o} (${e})</a>`;return t.innerHTML=a,Y.init({root:t,detectLinks:!0}),t},M=({lang:e,title:o})=>{const t=document.createElement("div"),a=`<a href="${W(e,o,!0,!1)}"><img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Wikipedia-logo-v2.png"></a>`;return t.innerHTML=a,Y.init({root:t,detectLinks:!0}),t},B=({lang:e,title:o})=>{const t=document.createElement("div"),a=`<span class="wmf-wp-with-preview" data-wikipedia-preview data-wp-title="${o}">${o} (${e})</span>`;return t.innerHTML=a,Y.init({root:t,lang:e}),t};var U,N,G;C.parameters={...C.parameters,docs:{...(U=C.parameters)==null?void 0:U.docs,source:{originalSource:`({
  lang,
  title
}) => {
  const container = document.createElement('div');
  const template = \`<a href="\${buildWikipediaUrl(lang, title, true, false)}">\${title} (\${lang})</a>\`;
  container.innerHTML = template;
  wikipediaPreview.init({
    root: container,
    detectLinks: true
  });
  return container;
}`,...(G=(N=C.parameters)==null?void 0:N.docs)==null?void 0:G.source}}};var R,_,F;M.parameters={...M.parameters,docs:{...(R=M.parameters)==null?void 0:R.docs,source:{originalSource:`({
  lang,
  title
}) => {
  const container = document.createElement('div');
  const template = \`<a href="\${buildWikipediaUrl(lang, title, true, false)}"><img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Wikipedia-logo-v2.png"></a>\`;
  container.innerHTML = template;
  wikipediaPreview.init({
    root: container,
    detectLinks: true
  });
  return container;
}`,...(F=(_=M.parameters)==null?void 0:_.docs)==null?void 0:F.source}}};var X,Q,j;B.parameters={...B.parameters,docs:{...(X=B.parameters)==null?void 0:X.docs,source:{originalSource:`({
  lang,
  title
}) => {
  const container = document.createElement('div');
  const template = \`<span class="wmf-wp-with-preview" data-wikipedia-preview data-wp-title="\${title}">\${title} (\${lang})</span>\`;
  container.innerHTML = template;
  wikipediaPreview.init({
    root: container,
    lang
  });
  return container;
}`,...(j=(Q=B.parameters)==null?void 0:Q.docs)==null?void 0:j.source}}};const xe=["Hyperlink","Image","Text"];export{C as Hyperlink,M as Image,B as Text,xe as __namedExportsOrder,Se as default};
//# sourceMappingURL=target.stories-YEZNk75l.js.map
