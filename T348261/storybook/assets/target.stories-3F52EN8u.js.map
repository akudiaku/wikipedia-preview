{"version":3,"file":"target.stories-3F52EN8u.js","sources":["../../src/event.js","../../src/popup.js","../../src/touchPopup.js","../../src/index.js"],"sourcesContent":["import { isTouch } from './utils'\nimport { getGalleryRow } from './gallery'\nimport { requestPageMedia } from './api'\n\nexport const customEvents = ( popup ) => {\n\n\tlet eventListenerStack = []\n\tlet timeoutStack = []\n\n\tconst addTimeout = ( func, timeout ) => {\n\t\tconst id = setTimeout( func, timeout )\n\t\ttimeoutStack.push( id )\n\t\treturn id\n\t}\n\n\tconst clearAllTimeout = () => {\n\t\ttimeoutStack.forEach( ( timeoutId ) => {\n\t\t\tclearTimeout( timeoutId )\n\t\t} )\n\t\ttimeoutStack = []\n\t}\n\n\tconst addEventListener = ( target, type, listener, options = undefined ) => {\n\t\ttarget.addEventListener( type, listener, options )\n\t\teventListenerStack.push( [ target, type, listener, options ] )\n\t}\n\n\tconst clearAllEventListener = () => {\n\t\teventListenerStack.forEach( ( eventListener ) => {\n\t\t\tconst [ target, type, listener, options ] = eventListener\n\t\t\ttarget.removeEventListener( type, listener, options )\n\t\t} )\n\t\teventListenerStack = []\n\t}\n\n\tconst onMouseLeave = ( e ) => {\n\t\tconst toElement = e.toElement || e.relatedTarget || e.target\n\t\tconst previewElement = popup.element.currentTargetElement\n\n\t\tif ( toElement !== previewElement && !popup.element.contains( toElement ) ) {\n\t\t\tconst timeoutId = addTimeout( popup.hide, 300 )\n\t\t\tconst persistPopup = () => {\n\t\t\t\tclearTimeout( timeoutId )\n\t\t\t}\n\n\t\t\taddEventListener( popup.element, 'mouseenter', persistPopup )\n\t\t}\n\t}\n\n\tconst setPreviewMaxHeight = ( max ) => {\n\t\tconst bodyElement = popup.element.querySelector( '.wikipediapreview-body' )\n\t\tconst headerElement = popup.element.querySelector( '.wikipediapreview-header' )\n\t\tconst footerElement = popup.element.querySelector( '.wikipediapreview-footer-cta' ) || popup.element.querySelector( '.wikipediapreview-footer-loading' )\n\n\t\tif ( !bodyElement ) {\n\t\t\treturn\n\t\t}\n\n\t\tif ( popup.element.style[ 2 ] === 'bottom' || popup.element.style.bottom ) {\n\t\t\t// expand up\n\t\t\tconst currentTop = popup.element.getBoundingClientRect().top\n\t\t\tconst originalHeight = parseInt(\n\t\t\t\twindow.getComputedStyle( bodyElement ).maxHeight.slice( 0, -2 )\n\t\t\t)\n\n\t\t\tbodyElement.style.maxHeight = Math.min( max, originalHeight + currentTop ) + 'px'\n\t\t} else {\n\t\t\t// expand down\n\t\t\tconst currentTop = popup.element.getBoundingClientRect().top\n\t\t\tconst headerHeight = window.getComputedStyle( headerElement ).height.slice( 0, -2 )\n\t\t\tconst footerHeight = footerElement ?\n\t\t\t\twindow.getComputedStyle( footerElement ).height.slice( 0, -2 ) : 0\n\t\t\tconst availableHeight = window.innerHeight - currentTop - headerHeight - footerHeight\n\n\t\t\tbodyElement.style.maxHeight = Math.min( max, availableHeight ) + 'px'\n\t\t}\n\t}\n\n\tconst onExpand = () => {\n\t\tconst maxHeight = 496\n\t\tconst { lang, title } = popup\n\n\t\tpopup.element.component.wikipediapreview.classList.add( 'expanded' )\n\n\t\tif ( !isTouch ) {\n\t\t\tsetPreviewMaxHeight( maxHeight )\n\t\t}\n\n\t\tif ( !popup.loading && lang && title ) {\n\t\t\trequestPageMedia( lang, title, ( mediaData ) => {\n\t\t\t\tconst galleryContainer = popup.element.component.wikipediapreviewGallery\n\t\t\t\tif ( mediaData && mediaData.length > 0 ) {\n\t\t\t\t\tgalleryContainer.appendChild( getGalleryRow( mediaData, popup ) )\n\t\t\t\t} else {\n\t\t\t\t\tpopup.element.component.body.removeChild( galleryContainer )\n\t\t\t\t}\n\t\t\t} )\n\t\t}\n\t}\n\n\tconst applyDragEvent = ( element ) => {\n\t\tlet initialY\n\t\tlet finalY\n\t\tlet previewBodyStyle\n\t\tlet initialHeight\n\n\t\tconst previewHeader = element.querySelector( '.wikipediapreview-header' )\n\t\tconst previewBody = element.querySelector( '.wikipediapreview-body' )\n\t\tconst handleTouchStart = ( e ) => {\n\t\t\tinitialY = e.touches[ 0 ].clientY\n\t\t\tpreviewBodyStyle = window.getComputedStyle( previewBody )\n\t\t\tinitialHeight = Number( previewBodyStyle.height.slice( 0, -2 ) )\n\t\t}\n\n\t\tconst handleTouchMove = ( e, isHeader ) => {\n\t\t\tif ( isHeader ) {\n\t\t\t\te.preventDefault()\n\t\t\t}\n\n\t\t\tconst clientY = e.touches[ 0 ].clientY\n\t\t\tconst offset = initialY - clientY\n\t\t\tconst currentHeight = initialHeight + offset\n\t\t\tconst expanded = element.querySelector( '.wikipediapreview.expanded' )\n\t\t\tconst isNotExpandedBody = !expanded && !isHeader || isHeader\n\n\t\t\tpreviewBody.style.transition = 'auto'\n\t\t\tfinalY = clientY\n\t\t\tif ( isNotExpandedBody ) {\n\t\t\t\tpreviewBody.style.maxHeight = currentHeight + 'px'\n\t\t\t}\n\t\t}\n\n\t\tconst handleTouchEnd = ( isHeader ) => {\n\t\t\tconst expanded = element.querySelector( '.wikipediapreview.expanded' )\n\t\t\tconst delta = initialY - finalY\n\t\t\tconst isOverThreshold = Math.abs( delta ) > 80\n\t\t\tconst isNotExpandedBody = !expanded && !isHeader || isHeader\n\n\t\t\tpreviewBody.style.transition = 'all 0.25s ease-in-out'\n\t\t\tif ( delta < 0 && isOverThreshold && isNotExpandedBody ) {\n\t\t\t\tpopup.hide()\n\t\t\t} else if ( delta > 0 && isOverThreshold && isNotExpandedBody && !expanded ) {\n\t\t\t\tpreviewBody.style.maxHeight = '70vh'\n\t\t\t\tonExpand()\n\t\t\t} else {\n\t\t\t\tpreviewBody.style.maxHeight = initialHeight + 'px'\n\t\t\t}\n\t\t}\n\n\t\taddEventListener( previewBody, 'touchstart', handleTouchStart )\n\t\taddEventListener( previewBody, 'touchmove', ( e ) => {\n\t\t\thandleTouchMove( e, false )\n\t\t} )\n\t\taddEventListener( previewBody, 'touchend', () => handleTouchEnd( false ) )\n\n\t\taddEventListener( previewHeader, 'touchstart', handleTouchStart )\n\t\taddEventListener( previewHeader, 'touchmove', ( e ) => {\n\t\t\thandleTouchMove( e, true )\n\t\t} )\n\t\taddEventListener( previewHeader, 'touchend', () => handleTouchEnd( true ) )\n\t}\n\n\tconst onHide = () => {\n\t\tpopup.element.component.wikipediapreview.classList.remove( 'expanded' )\n\t\tpopup.lang = null\n\t\tpopup.title = null\n\t\tpopup.loading = false\n\n\t\tconst previewBody = popup.element.querySelector( '.wikipediapreview-body' )\n\t\tpreviewBody.style.transition = 'auto'\n\n\t\tclearAllEventListener()\n\t\tclearAllTimeout()\n\t}\n\n\tconst onShow = ( element ) => {\n\t\telement.component = {\n\t\t\tbody: element.querySelector( '.wikipediapreview-body' ),\n\t\t\twikipediapreview: element.querySelector( '.wikipediapreview' ),\n\t\t\twikipediapreviewGallery: element.querySelector( '.wikipediapreview-gallery' ),\n\t\t\tcloseBtn: element.querySelector( '.wikipediapreview-header-closebtn' ),\n\t\t\treadMore: element.querySelector( '.wikipediapreview-footer-cta-readmore' ),\n\t\t\tcontent: element.querySelector( '.wikipediapreview-body > p' )\n\t\t}\n\n\t\t// @todo update the magic number\n\t\tif ( element.component.content &&\n\t\t\telement.component.content.getBoundingClientRect().height < 248 ) {\n\t\t\tonExpand( element )\n\t\t} else {\n\t\t\tif ( !isTouch ) {\n\t\t\t\tsetPreviewMaxHeight( 248 )\n\t\t\t}\n\t\t}\n\n\t\taddEventListener( element.component.closeBtn, 'click', popup.hide )\n\t\tif ( element.component.readMore ) {\n\t\t\taddEventListener( element.component.readMore, 'click', onExpand )\n\t\t}\n\n\t\tif ( isTouch ) {\n\t\t\tconst darkScreen = document.querySelector( '.wp-dark-screen' )\n\t\t\taddEventListener( darkScreen, 'click', popup.hide, true )\n\t\t\tapplyDragEvent( element )\n\t\t} else {\n\t\t\taddEventListener( element, 'mouseleave', onMouseLeave )\n\t\t\taddEventListener( element.currentTargetElement, 'mouseleave', onMouseLeave )\n\t\t}\n\t}\n\n\treturn { onHide, onShow, onExpand }\n}\n","import '../style/popup.less'\n\nlet popup\n\nconst computePopupPosition = (\n\ttargetRect,\n\tpopupWidth, popupHeight,\n\tinnerWidth, innerHeight\n) => {\n\tconst targetCenterX = targetRect.left + targetRect.width / 2\n\tconst targetCenterY = targetRect.top + targetRect.height / 2\n\tconst alignLeft = targetCenterX <= innerWidth / 2\n\tconst popupBelowTarget = targetCenterY <= innerHeight / 2\n\n\tconst left = alignLeft ?\n\t\ttargetRect.left :\n\t\ttargetRect.left + targetRect.width - popupWidth\n\n\tconst top = popupBelowTarget ?\n\t\ttargetRect.top + targetRect.height :\n\t\t''\n\n\tconst bottom = popupBelowTarget ?\n\t\t'' :\n\t\tinnerHeight - targetRect.top\n\n\treturn { left, top, bottom }\n}\n\nconst withPx = ( value ) => {\n\treturn value ? ( value + 'px' ) : value\n}\n\n// Strangely, mouseenter often fires with the pointer slightly\n// outside any element rect. Making the rects bigger by a few pixel\n// ensures the pointer will be inside one of them.\nconst expandRect = ( rect ) => {\n\tconst delta = 3\n\treturn {\n\t\tleft: rect.left - delta,\n\t\tright: rect.right + delta,\n\t\ttop: rect.top - delta,\n\t\tbottom: rect.bottom + delta\n\t}\n}\n\nconst getTargetRect = ( element, { x, y } ) => {\n\tconst rects = element.getClientRects()\n\tfor ( let i = 0; i < rects.length; i++ ) {\n\t\tconst rect = expandRect( rects[ i ] )\n\t\tif ( x >= rect.left && x <= rect.right &&\n\t\t\ty >= rect.top && y <= rect.bottom ) {\n\t\t\treturn rects[ i ]\n\t\t}\n\t}\n\t// fallback for unit tests\n\treturn rects[ 0 ] || element.getBoundingClientRect()\n}\n\nconst createPopup = ( container, win = window ) => {\n\tif ( !popup ) {\n\t\tpopup = win.document.createElement( 'div' )\n\t\tpopup.classList.add( 'wp-popup' )\n\t\tpopup.style.visibility = 'hidden'\n\t\tcontainer.appendChild( popup )\n\t}\n\n\tconst popupEvents = {/* onShow, onHide */}\n\n\tconst hide = () => {\n\t\tif ( popupEvents.onHide ) {\n\t\t\tpopupEvents.onHide( popup )\n\t\t}\n\t\tpopup.style.visibility = 'hidden'\n\t\tpopup.currentTargetElement = null\n\t}\n\n\tconst show = ( content, nextTo, pointerPosition ) => {\n\t\tpopup.innerHTML = content\n\n\t\tconst position = computePopupPosition(\n\t\t\tgetTargetRect( nextTo, pointerPosition ),\n\t\t\tpopup.offsetWidth,\n\t\t\tpopup.offsetHeight,\n\t\t\twin.innerWidth,\n\t\t\twin.innerHeight\n\t\t)\n\n\t\tpopup.style.left = withPx( position.left )\n\t\tpopup.style.top = withPx( position.top )\n\t\tpopup.style.bottom = withPx( position.bottom )\n\n\t\tpopup.currentTargetElement = nextTo\n\t\tpopup.style.visibility = 'visible'\n\n\t\tif ( popupEvents.onShow ) {\n\t\t\tpopupEvents.onShow( popup )\n\t\t}\n\t}\n\n\tconst subscribe = ( events = {} ) => {\n\t\tif ( events.onShow ) {\n\t\t\tpopupEvents.onShow = events.onShow\n\t\t}\n\t\tif ( events.onHide ) {\n\t\t\tpopupEvents.onHide = events.onHide\n\t\t}\n\t}\n\n\treturn { show, hide, subscribe, element: popup }\n}\n\nexport { createPopup, computePopupPosition }\n","import '../style/popup.less'\n\nlet popup\nlet originalOverflow\n\nconst addBackgroundScreen = ( document ) => {\n\tif ( !document.querySelector( '.wp-dark-screen' ) ) {\n\t\tconst screen = document.createElement( 'div' )\n\t\tscreen.classList.add( 'wp-dark-screen' )\n\t\tdocument.body.appendChild( screen )\n\t\toriginalOverflow = document.body.style.overflow\n\t\tdocument.body.style.overflow = 'hidden'\n\t}\n}\n\nconst removeBackgroundScreen = ( document ) => {\n\tconst screen = document.getElementsByClassName( 'wp-dark-screen' )\n\tdocument.body.removeChild( screen[ 0 ] )\n\tdocument.body.style.overflow = originalOverflow\n}\n\nconst createTouchPopup = ( container, win = window ) => {\n\tif ( !popup ) {\n\t\tpopup = win.document.createElement( 'div' )\n\t\tpopup.classList.add( 'wp-touch-popup' )\n\t\tpopup.style.visibility = 'hidden'\n\t\tcontainer.appendChild( popup )\n\t}\n\n\tconst popupEvents = {/* onShow, onHide */}\n\n\tconst show = ( content ) => {\n\t\tpopup.innerHTML = content\n\t\tpopup.style.visibility = 'visible'\n\t\taddBackgroundScreen( win.document )\n\n\t\tif ( popupEvents.onShow ) {\n\t\t\tpopupEvents.onShow( popup )\n\t\t}\n\t}\n\n\tconst hide = () => {\n\t\tif ( popupEvents.onHide ) {\n\t\t\tpopupEvents.onHide( popup )\n\t\t}\n\n\t\tpopup.style.visibility = 'hidden'\n\t\tremoveBackgroundScreen( win.document )\n\t}\n\n\tconst expand = () => {\n\t\tif ( popupEvents.onExpand ) {\n\t\t\tpopupEvents.onExpand()\n\t\t}\n\t}\n\n\tconst subscribe = ( events = {} ) => {\n\t\tif ( events.onShow ) {\n\t\t\tpopupEvents.onShow = events.onShow\n\t\t}\n\t\tif ( events.onHide ) {\n\t\t\tpopupEvents.onHide = events.onHide\n\t\t}\n\t\tif ( events.onExpand ) {\n\t\t\tpopupEvents.onExpand = events.onExpand\n\t\t}\n\t}\n\n\treturn { show, hide, expand, subscribe, element: popup }\n}\n\nexport { createTouchPopup }\n","import { requestPagePreview } from './api'\nimport { customEvents } from './event'\nimport { createPopup } from './popup'\nimport { createTouchPopup } from './touchPopup'\nimport { renderPreview, renderLoading, renderError, renderDisambiguation, renderOffline } from './preview'\nimport { getWikipediaAttrFromUrl, buildWikipediaUrl, isTouch, getDir, isOnline, version, getAnalyticsQueryParam } from './utils'\n\nconst invokeCallback = ( events, name, params ) => {\n\tconst callback = events && events[ name ]\n\tif ( callback instanceof Function ) {\n\t\ttry {\n\t\t\tcallback.apply( null, params )\n\t\t} catch ( e ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.log( 'Error invoking Wikipedia Preview custom callback', e )\n\t\t}\n\t}\n}\n\n// getPreviewHtml is meant to be used by the Wordpress plugin only\nconst getPreviewHtml = ( title, lang, callback ) => {\n\trequestPagePreview( lang, title, ( data ) => {\n\t\tcallback( renderPreview( lang, data, isTouch ) )\n\t} )\n}\n\nconst forEachRoot = ( rootConfig, callback ) => {\n\tconst roots = []\n\t// rootConfig can be a selector (String)\n\tif (\n\t\ttypeof rootConfig === 'string' ||\n\t\trootConfig instanceof String\n\t) {\n\t\tArray.prototype.forEach.call(\n\t\t\tdocument.querySelectorAll( rootConfig ),\n\t\t\t( node ) => { roots.push( node ) }\n\t\t)\n\t}\n\n\t// rootConfig can be a node (Document or Element)\n\tif ( rootConfig instanceof Document || rootConfig instanceof Element ) {\n\t\troots.push( rootConfig )\n\t}\n\n\t// rootConfig can be a list of nodes (Element[])\n\tif ( Array.isArray( rootConfig ) ) {\n\t\trootConfig.forEach( ( r ) => {\n\t\t\tif ( r instanceof Element ) {\n\t\t\t\troots.push( r )\n\t\t\t}\n\t\t} )\n\t}\n\n\troots.forEach( ( root ) => callback( root ) )\n}\n\nlet currentPopupId\n\nfunction init( {\n\troot = document,\n\tselector = '[data-wikipedia-preview]',\n\tlang = 'en',\n\tdetectLinks = false,\n\tpopupContainer = document.body,\n\tevents = {},\n\tdebug = false\n} ) {\n\tconst globalLang = lang\n\tconst popup = isTouch ?\n\t\tcreateTouchPopup( popupContainer ) :\n\t\tcreatePopup( popupContainer )\n\tconst popupEvents = customEvents( popup )\n\tconst last = {}\n\tconst foundSelectorLinks = []\n\tconst foundDetectLinks = []\n\n\tconst showPopup = ( e, refresh = false ) => {\n\t\te.preventDefault()\n\n\t\tconst popupId = Date.now()\n\t\tconst { currentTarget } = refresh ? last : e\n\t\tconst title = refresh ? last.title : decodeURIComponent( currentTarget.getAttribute( 'data-wp-title' ) || currentTarget.textContent )\n\t\tconst localLang = refresh ? last.lang : currentTarget.getAttribute( 'data-wp-lang' ) || globalLang\n\t\tconst pointerPosition = refresh ? last.pointerPosition : { x: e.clientX, y: e.clientY }\n\t\tconst dir = getDir( localLang )\n\n\t\tif ( popup.element.currentTargetElement === currentTarget && !refresh ) {\n\t\t\t// Hovering over the same link and the popup is already open\n\t\t\treturn\n\t\t}\n\n\t\tcurrentPopupId = popupId\n\n\t\tif ( popup.element.style.visibility === 'visible' ) {\n\t\t\tpopup.hide()\n\t\t}\n\n\t\tpopup.loading = true\n\t\tpopup.dir = dir\n\t\tpopup.show( renderLoading( isTouch, localLang, dir ), currentTarget, pointerPosition )\n\n\t\trequestPagePreview( localLang, title, ( data ) => {\n\t\t\tif ( popupId !== currentPopupId ) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif ( popup.loading ) {\n\t\t\t\tpopup.loading = false\n\t\t\t\tif ( data ) {\n\t\t\t\t\tpopup.lang = localLang\n\t\t\t\t\tpopup.title = title\n\t\t\t\t\tif ( data.type === 'standard' ) {\n\t\t\t\t\t\tpopup.show(\n\t\t\t\t\t\t\trenderPreview( localLang, data, isTouch ),\n\t\t\t\t\t\t\tcurrentTarget,\n\t\t\t\t\t\t\tpointerPosition\n\t\t\t\t\t\t)\n\t\t\t\t\t\tinvokeCallback( events, 'onShow', [ title, localLang, 'standard' ] )\n\t\t\t\t\t} else if ( data.type === 'disambiguation' ) {\n\t\t\t\t\t\tpopup.show(\n\t\t\t\t\t\t\trenderDisambiguation( isTouch, localLang, data.title, data.dir ),\n\t\t\t\t\t\t\tcurrentTarget,\n\t\t\t\t\t\t\tpointerPosition\n\t\t\t\t\t\t)\n\t\t\t\t\t\tinvokeCallback( events, 'onShow', [ title, localLang, 'disambiguation' ] )\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif ( isOnline() ) {\n\t\t\t\t\t\tpopup.show(\n\t\t\t\t\t\t\trenderError( isTouch, localLang, title, dir ),\n\t\t\t\t\t\t\tcurrentTarget,\n\t\t\t\t\t\t\tpointerPosition\n\t\t\t\t\t\t)\n\t\t\t\t\t\tinvokeCallback( events, 'onShow', [ title, localLang, 'error' ] )\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpopup.show(\n\t\t\t\t\t\t\trenderOffline( isTouch, localLang, dir ),\n\t\t\t\t\t\t\tcurrentTarget,\n\t\t\t\t\t\t\tpointerPosition\n\t\t\t\t\t\t)\n\t\t\t\t\t\tinvokeCallback( events, 'onShow', [ title, localLang, 'offline' ] )\n\t\t\t\t\t\tconst again = document.querySelector( '.wikipediapreview-body-action' )\n\t\t\t\t\t\tlast.lang = localLang\n\t\t\t\t\t\tlast.title = title\n\t\t\t\t\t\tlast.pointerPosition = pointerPosition\n\t\t\t\t\t\tlast.target = currentTarget\n\t\t\t\t\t\tagain.addEventListener( 'click', ( event ) => {\n\t\t\t\t\t\t\tshowPopup( event, true )\n\t\t\t\t\t\t} )\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst readOnWikiCta = popup.element.querySelector( '.wikipediapreview-footer-cta-readonwiki, .wikipediapreview-cta-readonwiki' )\n\t\t\t\tif ( readOnWikiCta ) {\n\t\t\t\t\treadOnWikiCta.addEventListener( 'click', () => {\n\t\t\t\t\t\tinvokeCallback( events, 'onWikiRead', [ title, localLang ] )\n\t\t\t\t\t} )\n\t\t\t\t}\n\t\t\t\t// add wprov to target's href\n\t\t\t\tif ( currentTarget.tagName === 'A' ) {\n\t\t\t\t\tconst param = getAnalyticsQueryParam().split( '=' )\n\t\t\t\t\tconst url = new URL( currentTarget.href )\n\t\t\t\t\turl.searchParams.set( param[ 0 ], param[ 1 ] )\n\t\t\t\t\tcurrentTarget.href = url.href\n\t\t\t\t}\n\t\t\t}\n\t\t} )\n\t}\n\n\tpopup.subscribe( popupEvents )\n\n\tforEachRoot( root, ( localRoot ) => {\n\t\tArray.prototype.forEach.call(\n\t\t\tlocalRoot.querySelectorAll( selector ),\n\t\t\t( node ) => {\n\t\t\t\tif ( isTouch ) {\n\t\t\t\t\tnode.addEventListener( 'click', showPopup )\n\t\t\t\t} else {\n\t\t\t\t\tnode.addEventListener( 'mouseenter', showPopup )\n\t\t\t\t}\n\n\t\t\t\tfoundSelectorLinks.push( {\n\t\t\t\t\ttext: node.textContent,\n\t\t\t\t\ttitle: node.getAttribute( 'data-wp-title' ) || node.textContent,\n\t\t\t\t\tlang: node.getAttribute( 'data-wp-lang' ) || globalLang\n\t\t\t\t} )\n\t\t\t}\n\t\t)\n\t} )\n\n\tif ( detectLinks ) {\n\t\tforEachRoot( root, ( localRoot ) => {\n\t\t\tArray.prototype.forEach.call(\n\t\t\t\tlocalRoot.querySelectorAll( 'a' ),\n\t\t\t\t( node ) => {\n\t\t\t\t\tconst matches = getWikipediaAttrFromUrl( node.getAttribute( 'href' ) )\n\t\t\t\t\tif ( matches ) {\n\t\t\t\t\t\tnode.setAttribute( 'data-wp-title', matches.title )\n\t\t\t\t\t\tnode.setAttribute( 'data-wp-lang', matches.lang )\n\t\t\t\t\t\tif ( isTouch ) {\n\t\t\t\t\t\t\tnode.addEventListener( 'click', showPopup )\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.addEventListener( 'mouseenter', showPopup )\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfoundDetectLinks.push( {\n\t\t\t\t\t\t\ttext: node.textContent,\n\t\t\t\t\t\t\ttitle: matches.title,\n\t\t\t\t\t\t\tlang: matches.lang\n\t\t\t\t\t\t} )\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t} )\n\t}\n\n\tif ( debug ) {\n\t\t/* eslint-disable no-console */\n\t\tconsole.group( 'Wikipedia Preview [debug mode]' )\n\t\tconsole.group( `Searching for \"${selector}\" inside ${root}, Total links found: ${foundSelectorLinks.length}` )\n\t\tfoundSelectorLinks.forEach( ( link, index ) => {\n\t\t\tconsole.log( index + 1, `${link.text} -> ${buildWikipediaUrl( link.lang, link.title, isTouch, false )}` )\n\t\t} )\n\t\tconsole.groupEnd()\n\t\tif ( detectLinks ) {\n\t\t\tconsole.group( `Searching for links to Wikipedia, Total links found: ${foundDetectLinks.length}` )\n\t\t\tfoundDetectLinks.forEach( ( link, index ) => {\n\t\t\t\tconsole.log( index + 1, `${link.text} -> ${buildWikipediaUrl( link.lang, link.title, isTouch, false )}` )\n\t\t\t} )\n\t\t\tconsole.groupEnd()\n\t\t}\n\t\tconsole.groupEnd()\n\t\t/* eslint-enable no-console */\n\t}\n\n}\n\nversion()\n\nexport default { init, version, getPreviewHtml }\n"],"names":["customEvents","popup","eventListenerStack","timeoutStack","addTimeout","func","timeout","id","clearAllTimeout","timeoutId","addEventListener","target","type","listener","options","clearAllEventListener","eventListener","onMouseLeave","e","toElement","previewElement","persistPopup","setPreviewMaxHeight","max","bodyElement","headerElement","footerElement","currentTop","originalHeight","headerHeight","footerHeight","availableHeight","onExpand","lang","title","isTouch","requestPageMedia","mediaData","galleryContainer","getGalleryRow","applyDragEvent","element","initialY","finalY","previewBodyStyle","initialHeight","previewHeader","previewBody","handleTouchStart","handleTouchMove","isHeader","clientY","offset","currentHeight","isNotExpandedBody","handleTouchEnd","expanded","delta","isOverThreshold","darkScreen","computePopupPosition","targetRect","popupWidth","popupHeight","innerWidth","innerHeight","targetCenterX","targetCenterY","alignLeft","popupBelowTarget","left","top","bottom","withPx","value","expandRect","rect","getTargetRect","x","y","rects","i","createPopup","container","win","popupEvents","content","nextTo","pointerPosition","position","events","originalOverflow","addBackgroundScreen","document","screen","removeBackgroundScreen","createTouchPopup","invokeCallback","name","params","callback","getPreviewHtml","requestPagePreview","data","renderPreview","forEachRoot","rootConfig","roots","node","r","root","currentPopupId","init","selector","detectLinks","popupContainer","debug","globalLang","last","foundSelectorLinks","foundDetectLinks","showPopup","refresh","popupId","currentTarget","localLang","dir","getDir","renderLoading","renderDisambiguation","isOnline","renderError","renderOffline","again","event","readOnWikiCta","param","getAnalyticsQueryParam","url","localRoot","matches","getWikipediaAttrFromUrl","link","index","buildWikipediaUrl","version","wikipediaPreview"],"mappings":"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"}