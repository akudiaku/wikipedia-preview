import{a as G,l as F,m as $,c as J,d as oe,s as ae,e as _,f as ce,h as V,g as ue,i as de}from"./utils-DhaRl4eE.js";const me=(e,t,i=!0)=>{const n=new XMLHttpRequest;n.open("GET",e),n.send(),n.addEventListener("load",()=>{const s=i?JSON.parse(n.responseText):n.responseText;t(s)}),n.addEventListener("error",()=>{t(!1,n.status)})},O={},w=(e,t,i,n=!0,s=me)=>{if(O[e]!==void 0){i(O[e]);return}s(e,(r,a)=>{r?i(O[e]=t(r)):i(!1,a)},n)},ge=e=>e.split("#")[0],fe=(e,t,i,n=w)=>{const r=J(e,{action:"query",prop:"extracts|pageimages",exsentences:4,explaintext:1,exsectionformat:"plain",piprop:"thumbnail",pilimit:1,titles:t})+"&"+G();n(r,a=>{const o=a.query.pages[Object.keys(a.query.pages)[0]];return o.extract?{title:t,extractHtml:"<p>"+o.extract+"</p>",imgUrl:o.thumbnail?o.thumbnail.source:null,dir:oe(e),type:"standard"}:!1},i)},pe=(e,t,i,n=w)=>{const s=`https://${e}.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(t)}?${G()}`;n(s,(r,a)=>r?r.type==="standard"||r.type==="disambiguation"?{title:r.titles.canonical,extractHtml:ae(r.extract_html),imgUrl:r.thumbnail?r.thumbnail.source:null,dir:r.dir,type:r.type}:r.type==="no-extract"&&r.description?{title:r.titles.canonical,extractHtml:"<p>"+r.description+"</p>",imgUrl:r.thumbnail?r.thumbnail.source:null,dir:r.dir,type:"standard"}:(F($(e,"preview-console-error-message",t,e),r),!1):(F($(e,"preview-console-error-message",t,e),a),!1),i)},ye=e=>{if(!e)return null;const t=["script","meta","style","figure","table","sup.mw-ref","sup.reference",".pcs-collapse-table-container",".thumb",".hatnote","[ role='navigation' ]","#pcs-edit-section-add-title-description"].join(",");for(const i of e.querySelectorAll(t))i.remove();for(const i of e.querySelectorAll("a"))i.outerHTML=i.innerHTML;for(const i of e.querySelectorAll("p"))i.innerHTML=i.innerHTML.replace(/\s\(.*?class=".*?(ext-phonos|IPA).*?".*?\)/g,"");return e.innerText.trim()===""?null:e.outerHTML},ve=e=>{const t=e.querySelector('meta[property="mw:leadImage"]');if(!t)return null;const i=t.getAttribute("content").split("/"),n=decodeURIComponent(i[i.length-1]),s=e.querySelector('a[href*="'+n+'"]');if(!s)return null;const r=s.querySelector("span[data-src]");if(r)return r.getAttribute("data-src");const a=s.querySelector("img[src]");return a?a.getAttribute("src"):null},he=(e,t,i,n=w)=>{const s=`https://${e}.wikipedia.org/api/rest_v1/page/mobile-html/${encodeURIComponent(t)}?${G()}`;n(s,(r,a)=>{if(!r)return F($(e,"preview-console-error-message",t,e),a),!1;const o=new DOMParser().parseFromString(r,"text/html"),d=ve(o);return{sections:Array.from(o.querySelectorAll("section")).map(m=>{const y=m.querySelector("h2, h3, h4, h5, h6"),q=y?y.id:t,p=y?y.tagName.toLowerCase():"h2",v=m.querySelector("figure span.mw-file-element"),I=v?v.getAttribute("data-src"):d,L=ye(m.querySelector("p"));return L?{id:q,level:p,imgUrl:I,extractHtml:L}:null}).filter(m=>m),dir:o.body.getAttribute("dir")}},i,!1)},$e=(e,t,i,n,s)=>{he(e,t,r=>{for(const a of r.sections)if(a.id===i){n({title:t+"#"+i,extractHtml:a.extractHtml,imgUrl:a.imgUrl,dir:r.dir,type:"standard"});return}n(!1)},s)},ze=(e,t,i,n=w)=>{const[s,r]=t.split("#");return r?$e(e,s,r,i,n):t.indexOf(":")===-1?pe(e,t,i,n):fe(e,t,i,n)},Fe=(e,t,i,n=w)=>{t=ge(t);const s=`https://${e}.wikipedia.org/api/rest_v1/page/media-list/${encodeURIComponent(t)}`;n(s,r=>(r.items||[]).reduce((d,u)=>{if(u.showInGallery&&u.type==="image"){const m=u&&u.srcset&&`https:${u.srcset[0].src}`,y={caption:u.caption&&u.caption.text.trim(),thumb:m,title:u.title};return d.concat(y)}return d},[]),i)},be=(e,t,i,n=w)=>{const s={action:"query",prop:"imageinfo",iiextmetadatafilter:"LicenseShortName|ImageDescription|Artist",iiextmetadatalanguage:e,iiextmetadatamultilang:1,iiurlwidth:V().width,iiurlheight:V().height,iiprop:"url|extmetadata",titles:t},r=J(e,s);n(r,a=>{const d=a.query.pages[0].imageinfo;if(!d)return{};const{Artist:u,ImageDescription:m,LicenseShortName:y}=d[0].extmetadata,q=u&&_(u.value),p=m&&_(typeof m.value=="string"&&m.value||m.value[e]||m.value[Object.keys(m.value)[0]]),v=d[0].thumburl;return{author:q,description:p,license:y&&y.value,filePage:ce(d[0].descriptionshorturl),bestFitImageUrl:v}},i)},H=1,Q=2,T=()=>window.innerWidth,U=()=>window.innerHeight,l={screenX:null,originalMarginLeft:null,currentMarginLeft:null,originalTransition:null,imgOriginalTransition:null,durationStart:null,translateX:0,translateY:0,clientX:null,clientY:null,imageRect:{}},g=[];let M=-1,E=!1;const X=e=>e.target.nodeName==="IMG"?e.target:e.target.querySelector("img"),K=e=>e?Number(e.slice(e.indexOf("scale")+6,-1)):H,xe=e=>{const i=/translate3d\((?<x>.*?)px, (?<y>.*?)px, (?<z>.*?)px/.exec(e);return i?`translate3d(${i.groups.x}px, ${i.groups.y}px, 0px)`:`translate3d(${l.translateX}px, ${l.translateY}px, 0px)`},k=(e,t)=>{const n=[`${t}-item-caption`,`${t}-item-caption-text`,`${t}-item-attribution`,`${t}-button`].find(s=>e.target.className.indexOf(s)>-1);return e.pointerType!=="touch"||n},A=()=>E,W=e=>e.naturalHeight<=e.naturalWidth,Se=e=>e.naturalWidth+50<T(),P=()=>g.length,we=(e,t=null)=>{const i={},n=()=>t.clientY>e.naturalHeight&&!W(e)?e.naturalHeight:t.clientY;return g.length===2?(i.x=(g[0].clientX+g[1].clientX)/2,i.y=(g[0].clientY+g[1].clientY)/2):(i.x=t.clientX,i.y=n()),i},ee=(e,t)=>{const i=we(e,t);return W(e)?i.y=i.y-e.naturalHeight:Se(e)&&(i.x=e.naturalWidth/2,i.y=e.naturalHeight/2),`${i.x}px ${i.y}px`},qe=e=>{for(let t=0;t<g.length;t++)if(g[t].pointerId===e.pointerId){g.splice(t,1);break}},te=e=>{e&&(e.style.transition=l.imgOriginalTransition,e.style.transform=`scale(${H})`,E=!1,l.translateX=0,l.translateY=0)},Le=e=>{const t=X(e);l.clientX=null,l.clientY=null,l.translateX=0,l.translateY=0,t.style.transformOrigin=ee(t,e),A()?(t.style.transform=`scale(${H})`,E=!1):(t.style.transform=`scale(${Q})`,E=!0)},Me=e=>{const t=X(e);if(!t)return;const i=t.getBoundingClientRect();if(l.imageRect.top=i.top,l.imageRect.bottom=i.bottom,l.imageRect.left=i.left,l.imageRect.right=i.right,g.length<1){const n=window.getComputedStyle(t);l.imgOriginalTransition=n.transition}g.push(e)},Te=e=>{const t=X(e),i=t.style.transform,n=.01,s=.4;let r=K(i);const a=xe(i);for(let o=0;o<g.length;o++)if(e.pointerId===g[o].pointerId){g[o]=e;break}if(g.length===2){const o=Math.abs(g[0].clientX-g[1].clientX),d=Math.abs(g[0].clientY-g[1].clientY),u=Math.sqrt(Math.pow(o,2)+Math.pow(d,2));M>0&&(t.style.transformOrigin=ee(t),t.style.transition="unset",u>M&&(E=!0,r+n<Q&&(r+=n,t.style.transform=`${a} scale(${r})`)),u<M&&(r-n>H+s?(r-=n,t.style.transform=`${a} scale(${r})`):te(t))),M=u}},Ee=(e,t,i,n,s)=>{const r=X(e);if(!r)return;const a=r.style.transform,o=K(a),d=T()/8,u=T()-d,m=W(r)?U()/4:U()/8,y=U()-m,q=80;r.style.transition="unset",(!l.clientX||!l.clientY)&&(l.clientX=e.clientX,l.clientY=e.clientY);const p=l.translateX+(e.clientX-l.clientX),v=l.translateY+(e.clientY-l.clientY),I=v-l.translateY>=0,L=p-l.translateX>=0,ne=()=>{const R=l.imageRect.left<d&&L||l.imageRect.right>u&&!L,le=l.imageRect.top<m&&I||l.imageRect.bottom>y&&!I;return R&&le},re=()=>{l.imageRect.top=l.imageRect.top+(v-l.translateY),l.imageRect.bottom=l.imageRect.bottom+(v-l.translateY),l.imageRect.left=l.imageRect.left+(p-l.translateX),l.imageRect.right=l.imageRect.right+(p-l.translateX),l.translateX=p,l.translateY=v,l.clientX=e.clientX,l.clientY=e.clientY},se=Math.abs(p)-Math.abs(l.translateX)>q;if(ne())re(),r.style.transform=`translate3d(${p}px, ${v}px, 0px) scale(${o})`;else if(se){const R=s==="ltr"&&p<0||s==="rtl"&&p>0;!R&&i[n-1]?t(-1):R&&i[n+1]&&t(1)}},Xe=e=>{const t=X(e);t&&(t.style.transition=l.imgOriginalTransition),qe(e),l.clientX=null,l.clientY=null,g.length<2&&(M=-1)},Ie=(e,t,i)=>{const n=window.getComputedStyle(t);l.durationStart=Date.now(),l.screenX=e.clientX,l.originalMarginLeft=+n[i].slice(0,-2),l.currentMarginLeft=+n[i].slice(0,-2),l.originalTransition=n.transition,t.style.transition="unset"},Re=(e,t,i,n)=>{const r=e.clientX-l.screenX;l.currentMarginLeft=l.originalMarginLeft+r*(n==="ltr"?1:-1),t.style[i]=l.currentMarginLeft+"px",e.preventDefault()},Ae=(e,t,i,n,s)=>{const r=l.originalMarginLeft-l.currentMarginLeft,a=Date.now()-l.durationStart;Math.abs(r/T())>.4||a<=300&&Math.abs(r)>5?i(r>0?1:-1):t.style[n]=-T()*s+"px"};let B=[];const N=(e,t,i,n=void 0)=>{e.addEventListener(t,i,n),B.push([e,t,i,n])},Ye=()=>{B.forEach(e=>{const[t,i,n,s]=e;t.removeEventListener(i,n,s)}),B=[]};let f=0,b="",C,Y,x;const j=()=>window.innerWidth,c="wp-gallery-fullscreen-slider",He=(e,t,i,n=[],s="")=>{const r=n.map(()=>`
		<div class="${c}-item">
				<div class="${c}-item-loading">
						<div class="${c}-item-loading-spinner">
								<div class="${c}-item-loading-spinner-animation">
										<div class="${c}-item-loading-spinner-animation-bounce"></div>
								</div>
						</div>
						<div class="${c}-item-loading-text">${$(e,"gallery-loading-still")}</div>
				</div>
				<div class="${c}-item-loading-error">
					<div class="${c}-item-loading-error-text">${$(e,"gallery-loading-error")}</div>
					<div class="${c}-item-loading-error-refresh">${$(e,"gallery-loading-error-refresh")}</div>
				</div>
		</div>
		`.trim()).join("");return n.some((a,o)=>a.thumb===s?(f=o,!0):!1),b=t,C=e,Y=n,x=i,`
		<div class="${c}" style="${b==="ltr"?"margin-left":"margin-right"}:-${f*j()}px">
				<div class="${c}-button previous"></div>
				<div class="${c}-button next"></div>
				${r}
		</div>
		`.trim()},Ce=e=>{const t=e.author?e.author:$(C,"gallery-unknown-author"),i=e.filePage;return`
		<div class="${c}-item-attribution">
			<div class="${c}-item-attribution-info">
				<bdi>${t} (${e.license})</bdi>
				<a href="${i}" class="${c}-item-attribution-info-link" target="_blank">Learn more ${ue()}</a>
			</div>
		</div>
	`.trim()},ie=(e,t=!1)=>{const i=e.querySelector("img"),n=e.querySelector(`.${c}-item-loading`),s=e.querySelector(`.${c}-item-loading-error`);if(t&&(x.querySelector(`.${c}`).querySelectorAll(`.${c}-item`).forEach(o=>{const d=o.querySelector("img"),u=o.querySelector(`.${c}-item-caption`),m=o.querySelector(`.${c}-item-attribution`);d&&o.removeChild(d),u&&o.removeChild(u),m&&o.removeChild(m)}),h(0,!0),n.style.visibility="visible",s.style.visibility="hidden"),i.complete)n.style.visibility="hidden",s.style.visibility="hidden",i.style.visibility="visible";else{const r=e.querySelector(`.${c}-item-loading-text`),a=setTimeout(()=>{r.style.visibility="visible"},5e3);i.addEventListener("load",()=>{n.style.visibility="hidden",s.style.visibility="hidden",r.style.visibility="hidden",clearTimeout(a)}),i.addEventListener("error",()=>{const o=e.querySelector(`.${c}-item-loading-error-refresh`);if(n.style.visibility="hidden",i.style.visibility="hidden",!de()){const d=e.querySelector(`.${c}-item-loading-error-text`);d.innerText=$(C,"gallery-loading-error-offline"),s.classList.add("offline")}s.style.visibility="visible",clearTimeout(a),o.addEventListener("click",()=>{ie(e,!0)})})}},D=(e,t=!1)=>{const s=x.querySelector(`.${c}`).querySelectorAll(`.${c}-item`)[e];s&&be(C,Y[e].title,r=>{const a=s.querySelector("img"),o=s.querySelector(`.${c}-item-attribution`);if(!a){const u=`<div class="${c}-item-caption">
						<div class="${c}-item-caption-text"><bdi>${r.description?r.description:Y[e].caption?Y[e].caption:""}</bdi></div>
					</div>`;s.insertAdjacentHTML("beforeend",`<div class="${c}-item-img"><img src="${r.bestFitImageUrl} ${t?"?timestamp="+Date.now():""}"/>${u}</div>`),ie(s)}o||s.insertAdjacentHTML("beforeend",Ce(r))})},h=(e=1,t=!1)=>{const i=x.querySelector(`.${c}`),n=i.querySelectorAll(`.${c}-item`),s=i.querySelector(".next"),r=i.querySelector(".previous"),a=f+e,o=n[a],d=n[f].querySelector("img");o&&(f+=e,s.style.visibility=f===n.length-1?"hidden":"visible",r.style.visibility=f===0?"hidden":"visible",te(d),D(f,t),D(f+1,t),D(f-1,t)),i.style[b==="ltr"?"marginLeft":"marginRight"]=-j()*f+"px";const u=x.querySelector(".wp-gallery-fullscreen-counter");u.textContent=f+1+"/"+n.length},z=()=>{h(-1)},Oe=()=>{const e=x.querySelector(`.${c}`),t=b==="ltr"?"marginLeft":"marginRight",i=e.querySelectorAll(`.${c}-item`);e.addEventListener("pointerdown",n=>{k(n,c)||(Me(n),P()===1&&!A()&&Ie(n,e,t))}),e.addEventListener("pointermove",n=>{k(n,c)||(P()>1?Te(n):A()?Ee(n,h,i,f,b):Re(n,e,t,b))}),e.addEventListener("pointerout",n=>{k(n,c)||(e.style.transition=l.originalTransition,P()===1&&!A()&&Ae(n,e,h,t,f),Xe(n))})},Ue=()=>{x.querySelector(".wp-gallery-fullscreen").classList.toggle("wp-gallery-fullscreen-focus-mode")},ke=()=>{const e=x.querySelector(`.${c}`),t=e.querySelectorAll(`.${c}-item`),i=e.querySelector(".next"),n=e.querySelector(".previous");let s=!1;h(0),Oe(),e.addEventListener("click",o=>{(o.target.className===`${c}-item`||o.target.tagName==="IMG")&&(s?(clearTimeout(s),s=null,Le(o)):s=setTimeout(()=>{s=null,Ue()},300))});const r=function(o){o.style.transition="unset",o.style.marginLeft=-f*j()+"px"};let a;N(window,"resize",()=>{const o=document.querySelector("."+c);r(o),clearTimeout(a),a=setTimeout(()=>{o.style.removeProperty("transition")},100)}),t.length===1?(n.style.visibility="hidden",i.style.visibility="hidden"):(i.addEventListener("click",()=>{h()}),n.addEventListener("click",()=>{z()}),N(window,"keydown",({key:o})=>{switch(o){case"ArrowRight":case"Right":b==="ltr"?h():z();break;case"ArrowLeft":case"Left":b==="ltr"?z():h();break}}))},S="wp-gallery-fullscreen",Pe=(e,t)=>`
		<div class="${S}" lang="${e}" dir="${t}">
			<div class="${S}-close"></div>
			<div class="${S}-counter"></div>
			<div class="${S}-main"></div>
		</div>
	`.trim(),Z=e=>{const t=e.querySelector(`.${S}`);e.removeChild(t),Ye()},Be=(e,t,i,n,s=document.body)=>{s.insertAdjacentHTML("beforeend",Pe(i,n)),s.querySelector(`.${S}-main`).insertAdjacentHTML("beforeend",He(i,n,s,e,t)),s.querySelector(`.${S}-close`).addEventListener("click",()=>{Z(s)}),N(window,"keydown",({key:a})=>{(a==="Escape"||a==="Esc")&&Z(s)}),ke()};export{ze as a,he as g,Fe as r,Be as s};
