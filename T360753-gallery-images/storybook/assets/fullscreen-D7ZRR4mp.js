import{a as j,l as B,m as $,c as J,d as ae,s as ce,e as _,f as ue,h as V,i as de}from"./utils-HmeVCEgW.js";const me=(e,t,n=!0)=>{const i=new XMLHttpRequest;i.open("GET",e),i.send(),i.addEventListener("load",()=>{const r=n?JSON.parse(i.responseText):i.responseText;t(r)}),i.addEventListener("error",()=>{t(!1,i.status)})},O={},q=(e,t,n,i=!0,r=me)=>{if(O[e]!==void 0){n(O[e]);return}r(e,(s,c)=>{s?n(O[e]=t(s)):n(!1,c)},i)},ge=e=>e.split("#")[0],fe=(e,t,n,i=q)=>{const s=J(e,{action:"query",prop:"extracts|pageimages",exsentences:4,explaintext:1,exsectionformat:"plain",piprop:"thumbnail",pilimit:1,titles:t})+"&"+j();i(s,c=>{const l=c.query.pages[Object.keys(c.query.pages)[0]];return l.extract?{title:t,extractHtml:"<p>"+l.extract+"</p>",imgUrl:l.thumbnail?l.thumbnail.source:null,dir:ae(e),type:"standard"}:!1},n)},pe=(e,t,n,i=q)=>{const r=`https://${e}.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(t)}?${j()}`;i(r,(s,c)=>s?s.type==="standard"||s.type==="disambiguation"?{title:s.titles.canonical,extractHtml:ce(s.extract_html),imgUrl:s.thumbnail?s.thumbnail.source:null,dir:s.dir,type:s.type}:s.type==="no-extract"&&s.description?{title:s.titles.canonical,extractHtml:"<p>"+s.description+"</p>",imgUrl:s.thumbnail?s.thumbnail.source:null,dir:s.dir,type:"standard"}:(B($(e,"preview-console-error-message",t,e),s),!1):(B($(e,"preview-console-error-message",t,e),c),!1),n)},ye=e=>{if(!e)return null;const t=["script","meta","style","figure","table","sup.mw-ref","sup.reference",".pcs-collapse-table-container",".thumb",".hatnote","[ role='navigation' ]","#pcs-edit-section-add-title-description"].join(",");for(const n of e.querySelectorAll(t))n.remove();for(const n of e.querySelectorAll("a"))n.outerHTML=n.innerHTML;for(const n of e.querySelectorAll("p"))n.innerHTML=n.innerHTML.replace(/\s\(.*?class=".*?(ext-phonos|IPA).*?".*?\)/g,"");return e.innerText.trim()===""?null:e.outerHTML},he=e=>{const t=e.querySelector('meta[property="mw:leadImage"]');if(!t)return null;const n=t.getAttribute("content").split("/"),i=decodeURIComponent(n[n.length-1]),r=e.querySelector('a[href*="'+i+'"]');if(!r)return null;const s=r.querySelector("span[data-src]");if(s)return s.getAttribute("data-src");const c=r.querySelector("img[src]");return c?c.getAttribute("src"):null},ve=(e,t,n,i=q)=>{const r=`https://${e}.wikipedia.org/api/rest_v1/page/mobile-html/${encodeURIComponent(t)}?${j()}`;i(r,(s,c)=>{if(!s)return B($(e,"preview-console-error-message",t,e),c),!1;const l=new DOMParser().parseFromString(s,"text/html"),u=he(l);return{sections:Array.from(l.querySelectorAll("section")).map(m=>{const p=m.querySelector("h2, h3, h4, h5, h6"),w=p?p.id:t,y=p?p.tagName.toLowerCase():"h2",h=m.querySelector("figure span.mw-file-element"),R=h?h.getAttribute("data-src"):u,L=ye(m.querySelector("p"));return L?{id:w,level:y,imgUrl:R,extractHtml:L}:null}).filter(m=>m),dir:l.body.getAttribute("dir")}},n,!1)},$e=(e,t,n,i,r)=>{ve(e,t,s=>{for(const c of s.sections)if(c.id===n){i({title:t+"#"+n,extractHtml:c.extractHtml,imgUrl:c.imgUrl,dir:s.dir,type:"standard"});return}i(!1)},r)},xe=(e,t,n,i=q)=>{const[r,s]=t.split("#");return s?$e(e,r,s,n,i):t.indexOf(":")===-1?pe(e,t,n,i):fe(e,t,n,i)},be=(e,t,n,i=q)=>{t=ge(t);const r=`https://${e}.wikipedia.org/api/rest_v1/page/media-list/${encodeURIComponent(t)}`;i(r,s=>(s.items||[]).reduce((u,d)=>{if(d.showInGallery&&d.type==="image"){const m=d&&d.srcset&&`https:${d.srcset[0].src}`,p={caption:d.caption&&d.caption.text.trim(),thumb:m,title:d.title};return u.concat(p)}return u},[]),n)},De=(e,t,n)=>{let i={};xe(e,t,r=>{r===!1?i={...i,extractHtml:!1}:i={...i,...r},i.media&&n(i)}),be(e,t,r=>{i={...i,media:r},i.extractHtml!==void 0&&n(i)})},Se=(e,t,n,i=q)=>{const r={action:"query",prop:"imageinfo",iiextmetadatafilter:"License|LicenseShortName|ImageDescription|Artist",iiextmetadatalanguage:e,iiextmetadatamultilang:1,iiurlwidth:V().width,iiurlheight:V().height,iiprop:"url|extmetadata",titles:t},s=J(e,r);i(s,c=>{const u=c.query.pages[0].imageinfo;if(!u)return{};const{Artist:d,ImageDescription:m,LicenseShortName:p}=u[0].extmetadata,w=d&&_(d.value),y=m&&_(typeof m.value=="string"&&m.value||m.value[e]||m.value[Object.keys(m.value)[0]]),h=u[0].thumburl;return{author:w,description:y,license:p&&p.value,filePage:ue(u[0].descriptionshorturl),bestFitImageUrl:h}},n)},C=1,Q=2,M=()=>window.innerWidth,P=()=>window.innerHeight,o={screenX:null,originalMarginLeft:null,currentMarginLeft:null,originalTransition:null,imgOriginalTransition:null,durationStart:null,translateX:0,translateY:0,clientX:null,clientY:null,imageRect:{}},g=[];let T=-1,E=!1;const I=e=>e.target.nodeName==="IMG"?e.target:e.target.querySelector("img"),K=e=>e?Number(e.slice(e.indexOf("scale")+6,-1)):C,qe=e=>{const n=/translate3d\((?<x>.*?)px, (?<y>.*?)px, (?<z>.*?)px/.exec(e);return n?`translate3d(${n.groups.x}px, ${n.groups.y}px, 0px)`:`translate3d(${o.translateX}px, ${o.translateY}px, 0px)`},U=(e,t)=>{const i=[`${t}-item-caption`,`${t}-item-caption-expand-cue`,`${t}-item-caption-text`,`${t}-item-attribution`,`${t}-button`].find(r=>e.target.className.indexOf(r)>-1);return e.pointerType!=="touch"||i},H=()=>E,G=e=>e.naturalHeight<=e.naturalWidth,we=e=>e.naturalWidth+50<M(),k=()=>g.length,Le=(e,t=null)=>{const n={},i=()=>t.clientY>e.naturalHeight&&!G(e)?e.naturalHeight:t.clientY;return g.length===2?(n.x=(g[0].clientX+g[1].clientX)/2,n.y=(g[0].clientY+g[1].clientY)/2):(n.x=t.clientX,n.y=i()),n},ee=(e,t)=>{const n=Le(e,t);return G(e)?n.y=n.y-e.naturalHeight:we(e)&&(n.x=e.naturalWidth/2,n.y=e.naturalHeight/2),`${n.x}px ${n.y}px`},Te=e=>{for(let t=0;t<g.length;t++)if(g[t].pointerId===e.pointerId){g.splice(t,1);break}},te=e=>{e&&(e.style.transition=o.imgOriginalTransition,e.style.transform=`scale(${C})`,E=!1,o.translateX=0,o.translateY=0)},Me=e=>{const t=I(e);o.clientX=null,o.clientY=null,o.translateX=0,o.translateY=0,t.style.transformOrigin=ee(t,e),H()?(t.style.transform=`scale(${C})`,E=!1):(t.style.transform=`scale(${Q})`,E=!0)},Ee=e=>{const t=I(e);if(!t)return;const n=t.getBoundingClientRect();if(o.imageRect.top=n.top,o.imageRect.bottom=n.bottom,o.imageRect.left=n.left,o.imageRect.right=n.right,g.length<1){const i=window.getComputedStyle(t);o.imgOriginalTransition=i.transition}g.push(e)},Xe=e=>{const t=I(e),n=t.style.transform,i=.01,r=.4;let s=K(n);const c=qe(n);for(let l=0;l<g.length;l++)if(e.pointerId===g[l].pointerId){g[l]=e;break}if(g.length===2){const l=Math.abs(g[0].clientX-g[1].clientX),u=Math.abs(g[0].clientY-g[1].clientY),d=Math.sqrt(Math.pow(l,2)+Math.pow(u,2));T>0&&(t.style.transformOrigin=ee(t),t.style.transition="unset",d>T&&(E=!0,s+i<Q&&(s+=i,t.style.transform=`${c} scale(${s})`)),d<T&&(s-i>C+r?(s-=i,t.style.transform=`${c} scale(${s})`):te(t))),T=d}},Ie=(e,t,n,i,r)=>{const s=I(e);if(!s)return;const c=s.style.transform,l=K(c),u=M()/8,d=M()-u,m=G(s)?P()/4:P()/8,p=P()-m,w=80;s.style.transition="unset",(!o.clientX||!o.clientY)&&(o.clientX=e.clientX,o.clientY=e.clientY);const y=o.translateX+(e.clientX-o.clientX),h=o.translateY+(e.clientY-o.clientY),R=h-o.translateY>=0,L=y-o.translateX>=0,re=()=>{const A=o.imageRect.left<u&&L||o.imageRect.right>d&&!L,le=o.imageRect.top<m&&R||o.imageRect.bottom>p&&!R;return A&&le},se=()=>{o.imageRect.top=o.imageRect.top+(h-o.translateY),o.imageRect.bottom=o.imageRect.bottom+(h-o.translateY),o.imageRect.left=o.imageRect.left+(y-o.translateX),o.imageRect.right=o.imageRect.right+(y-o.translateX),o.translateX=y,o.translateY=h,o.clientX=e.clientX,o.clientY=e.clientY},oe=Math.abs(y)-Math.abs(o.translateX)>w;if(re())se(),s.style.transform=`translate3d(${y}px, ${h}px, 0px) scale(${l})`;else if(oe){const A=r==="ltr"&&y<0||r==="rtl"&&y>0;!A&&n[i-1]?t(-1):A&&n[i+1]&&t(1)}},Re=e=>{const t=I(e);t&&(t.style.transition=o.imgOriginalTransition),Te(e),o.clientX=null,o.clientY=null,g.length<2&&(T=-1)},Ae=(e,t,n)=>{const i=window.getComputedStyle(t);o.durationStart=Date.now(),o.screenX=e.clientX,o.originalMarginLeft=+i[n].slice(0,-2),o.currentMarginLeft=+i[n].slice(0,-2),o.originalTransition=i.transition,t.style.transition="unset"},He=(e,t,n,i)=>{const s=e.clientX-o.screenX;o.currentMarginLeft=o.originalMarginLeft+s*(i==="ltr"?1:-1),t.style[n]=o.currentMarginLeft+"px",e.preventDefault()},Ce=(e,t,n,i,r)=>{const s=o.originalMarginLeft-o.currentMarginLeft,c=Date.now()-o.durationStart;Math.abs(s/M())>.4||c<=300&&Math.abs(s)>5?n(s>0?1:-1):t.style[i]=-M()*r+"px"};let D=[];const N=(e,t,n,i=void 0)=>{e.addEventListener(t,n,i),D.push([e,t,n,i])},Ye=()=>{D.forEach(e=>{const[t,n,i,r]=e;t.removeEventListener(n,i,r)}),D=[]};let f=0,x="",Y,W,S;const X=()=>window.innerWidth,a="wp-gallery-fullscreen-slider",Oe=(e,t,n,i=[],r="")=>{const s=i.map(()=>`
		<div class="${a}-item">
				<div class="${a}-item-loading">
						<div class="${a}-item-loading-spinner">
								<div class="${a}-item-loading-spinner-animation">
										<div class="${a}-item-loading-spinner-animation-bounce"></div>
								</div>
						</div>
						<div class="${a}-item-loading-text">${$(e,"gallery-loading-still")}</div>
				</div>
				<div class="${a}-item-loading-error">
					<div class="${a}-item-loading-error-text">${$(e,"gallery-loading-error")}</div>
					<div class="${a}-item-loading-error-refresh">${$(e,"gallery-loading-error-refresh")}</div>
				</div>
		</div>
		`.trim()).join("");return i.some((c,l)=>c.thumb===r?(f=l,!0):!1),x=t,Y=e,W=i,S=n,`
		<div class="${a}" style="${x==="ltr"?"margin-left":"margin-right"}:-${f*X()}px">
				<div class="${a}-button previous"></div>
				<div class="${a}-button next"></div>
				${s}
		</div>
		`.trim()},Pe=(e,t)=>{const n=()=>e.description?e.description:t.caption?t.caption:"",i=u=>{const d=["CC","BY","SA","Fair","Public"];let m="";return d.forEach(p=>{u&&u.indexOf(p)!==-1&&(m+=`<div class="${a}-item-attribution-info-${p.toLowerCase()}"></div>`)}),m},r=e.author?e.author:$(Y,"gallery-unknown-author"),s=e.filePage,c=n();return`
		<div class="${a}-item-caption">
			${(X()<400&&c.length>128?!0:X()>400&&c.length>142)?`<div class="${a}-item-caption-expand-cue"></div>`:""}
			${c?`<div class="${a}-item-caption-text"><bdi>${c}</bdi></div>`:""}
		</div>
		<div class="${a}-item-attribution">
			<div class="${a}-item-attribution-info">
				${i(e.license)}
				${r?`<bdi class="${a}-item-attribution-info-author">${r}</bdi>`:""}
			</div>
			${s?`<div class="${a}-item-attribution-more-info">
				<a href="${s}" class="${a}-item-attribution-more-info-link" target="_blank"></a>
			</div>`:""}
		</div>
	`.trim()},ie=(e,t=!1)=>{const n=e.querySelector("img"),i=e.querySelector(`.${a}-item-loading`),r=e.querySelector(`.${a}-item-loading-error`);if(t&&(S.querySelector(`.${a}`).querySelectorAll(`.${a}-item`).forEach(l=>{const u=l.querySelector("img"),d=l.querySelector(`.${a}-item-caption`),m=l.querySelector(`.${a}-item-attribution`);u&&l.removeChild(u),d&&l.removeChild(d),m&&l.removeChild(m)}),v(0,!0),i.style.visibility="visible",r.style.visibility="hidden"),n.complete)i.style.visibility="hidden",r.style.visibility="hidden",n.style.visibility="visible";else{const s=e.querySelector(`.${a}-item-loading-text`),c=setTimeout(()=>{s.style.visibility="visible"},5e3);n.addEventListener("load",()=>{i.style.visibility="hidden",r.style.visibility="hidden",s.style.visibility="hidden",clearTimeout(c)}),n.addEventListener("error",()=>{const l=e.querySelector(`.${a}-item-loading-error-refresh`);if(i.style.visibility="hidden",n.style.visibility="hidden",!de()){const u=e.querySelector(`.${a}-item-loading-error-text`);u.innerText=$(Y,"gallery-loading-error-offline"),r.classList.add("offline")}r.style.visibility="visible",clearTimeout(c),l.addEventListener("click",()=>{ie(e,!0)})})}},ne=(e,t=!1)=>{const n=e.querySelector(`.${a}-item-caption-text`),i=e.querySelector(`.${a}-item-caption-expand-cue`),r=e.querySelector(".expanded");i&&r||t&&i?(i.classList.remove("expanded"),n.style.maxHeight="80px"):i&&(i.classList.add("expanded"),n.style.maxHeight="241px")},F=(e,t=!1)=>{const r=S.querySelector(`.${a}`).querySelectorAll(`.${a}-item`)[e];r&&Se(Y,W[e].title,s=>{const c=r.querySelector("img"),l=r.querySelector(`.${a}-item-caption`);c||(t?r.insertAdjacentHTML("beforeend",`<img src="${s.bestFitImageUrl}?timestamp=${Date.now()}"/>`):r.insertAdjacentHTML("beforeend",`<img src="${s.bestFitImageUrl}"/>`),ie(r)),l||(r.insertAdjacentHTML("beforeend",Pe(s,W[e])),r.querySelector(`.${a}-item-caption`).addEventListener("click",()=>{ne(r)}))})},v=(e=1,t=!1)=>{const n=S.querySelector(`.${a}`),i=n.querySelectorAll(`.${a}-item`),r=n.querySelector(".next"),s=n.querySelector(".previous"),c=f+e,l=i[c],u=i[f].querySelector("img");l&&(ne(i[f],!0),f+=e,r.style.opacity=f===i.length-1?"0.5":"1",s.style.opacity=f===0?"0.5":"1",te(u),F(f,t),F(f+1,t),F(f-1,t)),n.style[x==="ltr"?"marginLeft":"marginRight"]=-X()*f+"px"},z=()=>{v(-1)},Ue=()=>{const e=S.querySelector(`.${a}`),t=x==="ltr"?"marginLeft":"marginRight",n=e.querySelectorAll(`.${a}-item`);e.addEventListener("pointerdown",i=>{U(i,a)||(Ee(i),k()===1&&!H()&&Ae(i,e,t))}),e.addEventListener("pointermove",i=>{U(i,a)||(k()>1?Xe(i):H()?Ie(i,v,n,f,x):He(i,e,t,x))}),e.addEventListener("pointerout",i=>{U(i,a)||(e.style.transition=o.originalTransition,k()===1&&!H()&&Ce(i,e,v,t,f),Re(i))})},ke=()=>{S.querySelector(".wp-gallery-fullscreen").classList.toggle("wp-gallery-fullscreen-focus-mode")},Fe=()=>{const e=S.querySelector(`.${a}`),t=e.querySelectorAll(`.${a}-item`),n=e.querySelector(".next"),i=e.querySelector(".previous");let r=!1;v(0),Ue(),e.addEventListener("click",l=>{(l.target.className===`${a}-item`||l.target.tagName==="IMG")&&(r?(clearTimeout(r),r=null,Me(l)):r=setTimeout(()=>{r=null,ke()},300))});const s=function(l){l.style.transition="unset",l.style.marginLeft=-f*X()+"px"};let c;N(window,"resize",()=>{const l=document.querySelector("."+a);s(l),clearTimeout(c),c=setTimeout(()=>{l.style.removeProperty("transition")},100)}),t.length===1?(i.style.visibility="hidden",n.style.visibility="hidden"):(n.addEventListener("click",()=>{v()}),i.addEventListener("click",()=>{z()}),N(window,"keydown",({key:l})=>{switch(l){case"ArrowRight":case"Right":x==="ltr"?v():z();break;case"ArrowLeft":case"Left":x==="ltr"?z():v();break}}))},b="wp-gallery-fullscreen",ze=(e,t)=>`
		<div class="${b}" lang="${e}" dir="${t}">
			<div class="${b}-close"></div>
			<div class="${b}-main"></div>
		</div>
	`.trim(),Z=e=>{const t=e.querySelector(`.${b}`);e.removeChild(t),Ye()},Ne=(e,t,n,i,r=document.body)=>{if(r.querySelector(`.${b}`))return;r.insertAdjacentHTML("beforeend",ze(n,i)),r.querySelector(`.${b}-main`).insertAdjacentHTML("beforeend",Oe(n,i,r,e,t)),r.querySelector(`.${b}-close`).addEventListener("click",()=>{Z(r)}),N(window,"keydown",({key:c})=>{(c==="Escape"||c==="Esc")&&Z(r)}),Fe()};export{ve as g,De as r,Ne as s};
